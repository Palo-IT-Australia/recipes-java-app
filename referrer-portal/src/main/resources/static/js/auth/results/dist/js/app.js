/*! patient-search - v0.0.1 - 2019-11-05 */
function imedvisageBase(){return"/referrer/imedvisage/v1"}function isViewIvEv(){return!1}function formatDate(a){return a.getFullYear()+"-"+("0"+(a.getMonth()+1)).slice(-2)+"-"+("0"+a.getDate()).slice(-2)}function dateRange(a,b){return[moment().add(a,"days").format("YYYY-MM-DD"),moment().add(b,"days").format("YYYY-MM-DD")]}function flatten(a){var b=document.createDocumentFragment();return a.each(function(a,c){b.appendChild(c)}),b}function configureTable(a){a.columns(".select-filter").every(function(){var a=this,b=$('<select><option value=""></option></select>').appendTo(this.header()).on("change",function(){""!=$(this).val()?a.search($(this).val()).draw():a.search("")});_.without(_.uniq(this.cache("search").sort().join(",").replace(/\s+/g,"").split(",")),"").forEach(function(a){b.append($('<option value="'+a+'">'+a+"</option>"))})}),a.columns(".search-filter").every(function(){var a=this;$('<input type="text" /><br/>').appendTo(this.header()).on("keyup",function(){a.search($(this).val()).draw()})})}this.JST=this.JST||{},this.JST["app/templates/Main/main.hbs"]=Handlebars.template(function(a,b,c,d,e){return this.compilerInfo=[4,">= 1.0.0"],c=this.merge(c,a.helpers),e=e||{},'<main role="main">\n    <div class="wrapper">\n        <div id="search">\n\n        </div>\n        <div class="row">\n            <div class="col-md-12" id="results">\n\n            </div>\n            <div class="col-md-6" id="images" style="z-index:1000;display:none;position:fixed;right:0;bottom:41px;">\n\n            </div>\n        </div>\n    </div>\n</main>\n'}),this.JST["app/templates/Order/order.hbs"]=Handlebars.template(function(a,b,c,d,e){function f(a,b){return'<a id="referral" class="link-info button-primary w-button full-width">View Referral</a>'}function g(a,b){return'\n                    <a class="link-info button-primary w-button full-width" id="vuemotionButton">DISPLAY IMAGES</a>\n                '}function h(a,b){return'<a id="viewbyiv" class="link-info button-primary w-button full-width">Launch InteleViewer</a>'}function i(a,b){return'\n                        <a class="link-info button-primary w-button full-width" id="vuemotionButton">DISPLAY IMAGES</a>    \n                    '}this.compilerInfo=[4,">= 1.0.0"],c=this.merge(c,a.helpers),e=e||{};var j,k="",l=this;return k+='<div id="patient"></div>\n<div id="report-panel">\n    <div>\n        <div class="row w-row">\n            <div class="w-col w-col-6 button-left-col">\n                 ',j=c["if"].call(b,(j=b&&b.order,null==j||j===!1?j:j.referralAvailable),{hash:{},inverse:l.noop,fn:l.program(1,f,e),data:e}),(j||0===j)&&(k+=j),k+='\n            </div>\n            <div class="w-col w-col-6 button-right-col">\n                <a id="report-pdf" class="link-info button-primary w-button full-width">Download Report</a>\n            </div>\n        </div>\n        <div class="row w-row">\n            <div class="w-col w-col-6 button-left-col">\n                ',j=c["if"].call(b,(j=b&&b.order,null==j||j===!1?j:j.dicomAvailable),{hash:{},inverse:l.noop,fn:l.program(3,g,e),data:e}),(j||0===j)&&(k+=j),k+='\n            </div>\n            <div class="w-col w-col-6 button-right-col">\n                ',j=c["if"].call(b,(j=b&&b.order,null==j||j===!1?j:j.dicomAvailable),{hash:{},inverse:l.noop,fn:l.program(5,h,e),data:e}),(j||0===j)&&(k+=j),k+='\n            </div>\n        </div>\n        <div id="report"></div>\n        <div id="reportbottom" style="/*overflow:hidden;*/">\n            <div id="order"></div>\n            <a class="back-btn orange-border-btn" href="javascript:void(0)">< Back</a>\n            <div class="row w-row">\n                <div class="w-col w-col-6 button-left-col">\n                    ',j=c["if"].call(b,(j=b&&b.order,null==j||j===!1?j:j.referralAvailable),{hash:{},inverse:l.noop,fn:l.program(1,f,e),data:e}),(j||0===j)&&(k+=j),k+='\n                </div>\n                <div class="w-col w-col-6 button-right-col">\n                    <a id="report-pdf" class="link-info button-primary w-button full-width">Download Report</a>\n                </div>\n            </div>\n            <div class="row w-row">\n                <div class="w-col w-col-6 button-left-col">\n                    ',j=c["if"].call(b,(j=b&&b.order,null==j||j===!1?j:j.dicomAvailable),{hash:{},inverse:l.noop,fn:l.program(7,i,e),data:e}),(j||0===j)&&(k+=j),k+='\n                </div>\n                <div class="w-col w-col-6 button-right-col">\n                    ',j=c["if"].call(b,(j=b&&b.order,null==j||j===!1?j:j.dicomAvailable),{hash:{},inverse:l.noop,fn:l.program(5,h,e),data:e}),(j||0===j)&&(k+=j),k+="\n                </div>\n            </div>\n        </div>\n    </div>\n</div>\n"}),this.JST["app/templates/Order/vieweritem.hbs"]=Handlebars.template(function(a,b,c,d,e){this.compilerInfo=[4,">= 1.0.0"],c=this.merge(c,a.helpers),e=e||{};var f,g,h="",i="function",j=this.escapeExpression;return h+='<a href="javascript:">',(g=c.name)?f=g.call(b,{hash:{},data:e}):(g=b&&b.name,f=typeof g===i?g.call(b,{hash:{},data:e}):g),h+=j(f)+"</a>\n"}),this.JST["app/templates/Order/viewers.hbs"]=Handlebars.template(function(a,b,c,d,e){return this.compilerInfo=[4,">= 1.0.0"],c=this.merge(c,a.helpers),e=e||{},'<li class="dropdown-header"><b>Study</b></li>'}),this.JST["app/templates/OrderHeader/orderheader.hbs"]=Handlebars.template(function(a,b,c,d,e){function f(a,b){var d,e="";return d=c.unless.call(a,null==b||b===!1?b:b.first,{hash:{},inverse:j.noop,fn:j.program(2,g,b),data:b}),(d||0===d)&&(e+=d),e+=l(typeof a===k?a.apply(a):a)}function g(a,b){return", "}this.compilerInfo=[4,">= 1.0.0"],c=this.merge(c,a.helpers),e=e||{};var h,i="",j=this,k="function",l=this.escapeExpression;return i+='<form class="form-horizontal">\n    <div class="form-group">\n        <div class="col-md-4">\n            <p class="control-label"><strong>Reported By</strong></p>\n        </div>\n        <div class="col-md-8">\n            <p class="form-control-static">',h=c.each.call(b,(h=b&&b.order,null==h||h===!1?h:h.reportingDrs),{hash:{},inverse:j.noop,fn:j.program(1,f,e),data:e}),(h||0===h)&&(i+=h),i+='</p>\n        </div>\n    </div>\n    <div class="form-group">\n        <div class="col-md-4">\n            <p class="control-label"><strong>Referred By</strong></p>\n        </div>\n        <div class="col-md-8">\n            <p class="form-control-static">'+l((h=b&&b.order,h=null==h||h===!1?h:h.referrer,h=null==h||h===!1?h:h.name,typeof h===k?h.apply(b):h))+"</p>\n        </div>\n    </div>\n</form>\n"}),this.JST["app/templates/OrderReport/orderreport.hbs"]=Handlebars.template(function(a,b,c,d,e){this.compilerInfo=[4,">= 1.0.0"],c=this.merge(c,a.helpers),e=e||{};var f,g,h="",i="function";return h+='<!--<div style="white-space: pre-wrap;">-->\n',(g=c.report)?f=g.call(b,{hash:{},data:e}):(g=b&&b.report,f=typeof g===i?g.call(b,{hash:{},data:e}):g),(f||0===f)&&(h+=f),h+="\n"}),this.JST["app/templates/Patient/patient.hbs"]=Handlebars.template(function(a,b,c,d,e){return this.compilerInfo=[4,">= 1.0.0"],c=this.merge(c,a.helpers),e=e||{},'<div id="patient"></div>\n<div id="orders"></div>\n'}),this.JST["app/templates/PatientHeader/patientheader.hbs"]=Handlebars.template(function(a,b,c,d,e){this.compilerInfo=[4,">= 1.0.0"],c=this.merge(c,a.helpers),e=e||{};var f,g="",h="function",i=this.escapeExpression;return g+='<div class="wrapper">\n    <div class="row w-row patient-name-row">\n    <div class="w-col w-col-12">\n        <p><strong><span class="patient-surname">'+i((f=b&&b.patient,f=null==f||f===!1?f:f.name,typeof f===h?f.apply(b):f))+'</span></strong></p>\n    </div>\n    </div>\n    <div class="row w-row">\n    <div class="w-col w-col-12">\n        <div class="row w-row patient-details-row">\n        <div class="w-col w-col-6">\n            <p>DOB: <span class="patient-birthday">'+i((f=b&&b.patient,f=null==f||f===!1?f:f.dobAus,typeof f===h?f.apply(b):f))+'</span></p>\n        </div>\n        <div class="w-col w-col-6 patient-id-col">\n            <p>\n            <strong>Patient ID:</strong><span class="patient-id">'+i((f=b&&b.patient,f=null==f||f===!1?f:f.id,typeof f===h?f.apply(b):f))+'</span>\n            </p>\n        </div>\n        </div>\n    </div>\n    </div>\n    <div class="row w-row patient-name-row">\n    <div class="w-col w-col-12">\n        <p><strong><span class="patient-order-item">Address</span></strong></p>\n    </div>\n    </div>\n    <div class="row w-row">\n    <div class="w-col w-col-12">\n        <div class="row w-row patient-details-row">\n        <div class="w-col w-col-6">\n            <p><span class="order-date">'+i((f=b&&b.patient,f=null==f||f===!1?f:f.address,typeof f===h?f.apply(b):f))+'</span></p>\n        </div>\n        <div class="w-col w-col-6 urgency-col">\n            <p>\n            <strong>\n                <span class="urgency-value"></span>\n            </strong>\n            </p>\n        </div>\n        </div>\n    </div>\n    </div>\n</div>\n'}),this.JST["app/templates/PatientOrders/patientorder.hbs"]=Handlebars.template(function(a,b,c,d,e){function f(a,b){return' class="warning"'}function g(a,b){return'<span class="glyphicon glyphicon-lock"></span>'}function h(a,b){return'\n            <div id="popupOrder" class="popover">\n                <div class="arrow"></div>\n                <div class="popover-content"><button class="btn btn-danger" id="bgorder">Break Glass - EMERGENCY USE</button></div>\n            </div>\n        '}function i(a,b){var d,e="";return d=c.unless.call(a,null==b||b===!1?b:b.first,{hash:{},inverse:o.noop,fn:o.program(8,j,b),data:b}),(d||0===d)&&(e+=d),e+=q((d=a&&a.modality,typeof d===p?d.apply(a):d))}function j(a,b){return"\n        , "}this.compilerInfo=[4,">= 1.0.0"],c=this.merge(c,a.helpers),e=e||{};var k,l,m,n="",o=this,p="function",q=this.escapeExpression,r=c.helperMissing;return n+="<tr",l=c.compare||b&&b.compare,m={hash:{operator:"!="},inverse:o.noop,fn:o.program(1,f,e),data:e},k=l?l.call(b,(k=b&&b.order,null==k||k===!1?k:k.status),"complete",m):r.call(b,"compare",(k=b&&b.order,null==k||k===!1?k:k.status),"complete",m),(k||0===k)&&(n+=k),n+='>\n    <td data-sort-value="'+q((k=b&&b.order,k=null==k||k===!1?k:k.date,typeof k===p?k.apply(b):k))+'">'+q((k=b&&b.order,k=null==k||k===!1?k:k.dateAus,typeof k===p?k.apply(b):k))+'</td>\n    <td><a id="order" href="javascript:">\n        ',k=c.unless.call(b,(k=b&&b.order,null==k||k===!1?k:k.accessible),{hash:{},inverse:o.noop,fn:o.program(3,g,e),data:e}),(k||0===k)&&(n+=k),n+="\n        "+q((k=b&&b.order,k=null==k||k===!1?k:k.description,typeof k===p?k.apply(b):k))+"</a>\n        ",k=c.unless.call(b,(k=b&&b.order,null==k||k===!1?k:k.accessible),{hash:{},inverse:o.noop,fn:o.program(5,h,e),data:e}),(k||0===k)&&(n+=k),n+="\n    </td>\n    <td>",k=c.each.call(b,(k=b&&b.order,null==k||k===!1?k:k.procedures),{hash:{},inverse:o.noop,fn:o.program(7,i,e),data:e}),(k||0===k)&&(n+=k),n+="</td>\n    <td>"+q((k=b&&b.order,k=null==k||k===!1?k:k.referrer,k=null==k||k===!1?k:k.name,typeof k===p?k.apply(b):k))+"</td>\n    <td>"+q((k=b&&b.order,k=null==k||k===!1?k:k.status,typeof k===p?k.apply(b):k))+"</td>\n</tr>\n"}),this.JST["app/templates/PatientOrders/patientorders.hbs"]=Handlebars.template(function(a,b,c,d,e){function f(a,b){var d,e,f="";return f+='<div class="btn btn-warning" id="showAll">Break Glass (',(e=c.hidden)?d=e.call(a,{hash:{},data:b}):(e=a&&a.hidden,d=typeof e===k?e.call(a,{hash:{},data:b}):e),(d||0===d)&&(f+=d),f+=" exams hidden)</div>"}this.compilerInfo=[4,">= 1.0.0"],c=this.merge(c,a.helpers),e=e||{};var g,h,i,j="",k="function",l=this,m=c.helperMissing;return j+='<h2>Examinations</h2>\n<table class="table" id="srTable" data-cascade="true" data-sorting="true">\n    <thead>\n    <tr>\n        <th data-sort-use="text" data-sorted="true" data-direction="DESC">Study Date</th>\n        <th data-class-name="search-filter" data-type="html" data-sort-use="text" >Description</th>\n        <th data-class-name="select-filter" data-breakpoints="sm">Modality</th>\n        <th data-breakpoints="sm">Referrer</th>\n        <th>Status</th>\n    </tr>\n    </thead>\n    <tbody>\n    </tbody>\n    <tfoot>\n    <tr>\n        <td></td>\n        <td></td>\n        <td></td>\n        <td></td>\n        <td></td>\n    </tr>\n    </tfoot>\n</table>\n<div>\n    ',h=c.compare||b&&b.compare,i={hash:{operator:"!="},inverse:l.noop,fn:l.program(1,f,e),data:e},g=h?h.call(b,b&&b.hidden,0,i):m.call(b,"compare",b&&b.hidden,0,i),(g||0===g)&&(j+=g),j+='\n</div>\n<div style="margin-top: 10px;">\n    <a class="back-btn orange-border-btn" href="javascript:void(0)" onClick="history.back();">< Back</a>\n</div>'}),this.JST["app/templates/Search/history.hbs"]=Handlebars.template(function(a,b,c,d,e){return this.compilerInfo=[4,">= 1.0.0"],c=this.merge(c,a.helpers),e=e||{},'<li class="dropdown-header"><b>History</b></li>\n'}),this.JST["app/templates/Search/historyitem.hbs"]=Handlebars.template(function(a,b,c,d,e){this.compilerInfo=[4,">= 1.0.0"],c=this.merge(c,a.helpers),e=e||{};var f,g,h="",i="function",j=this.escapeExpression;return h+='<a href="javascript:">',(g=c.name)?f=g.call(b,{hash:{},data:e}):(g=b&&b.name,f=typeof g===i?g.call(b,{hash:{},data:e}):g),h+=j(f)+"</a>\n"}),this.JST["app/templates/Search/reportNotify.hbs"]=Handlebars.template(function(a,b,c,d,e){function f(a,b){var d,e="";return e+='\r\n<!--<a href="#popupReportNotify" data-toggle="modal-popover"><span class="label label-success">Your have new reports</span></a>-->\r\n<div class="alert alert-success" role="alert">\r\n  <a id="popupReportNotifyTrigger" href="javascript:void(0);" class="alert-link" onClick=\'$("#popupReportNotify").toggle();\'>You have new reports in the past two hours</a>\r\n</div>\r\n<div style="width:auto;min-width:600px;left:250px;" id="popupReportNotify" class="popover">\r\n    <div class="arrow"></div>\r\n    <div class="popover-content">\r\n        <table class="table" style="color: #3a3a3a;">\r\n            <thead>\r\n                <tr><th>Name</th><th>Patient ID</th><th>DOB</th><th>Priority</th></tr>\r\n            </thead>\r\n            <tbody>\r\n                ',d=c.each.call(a,a&&a.orders,{hash:{},inverse:k.noop,fn:k.program(2,g,b),data:b}),(d||0===d)&&(e+=d),e+='\r\n            </tbody>\r\n        </table>\r\n    </div>\r\n</div>\r\n<script>\r\n    $("#body").click(function(event){\r\n        if($(event.target).closest(".popover").attr(\'id\') != "popupReportNotify" && $(event.target).attr(\'id\') != "popupReportNotifyTrigger")\r\n        {\r\n            $("#popupReportNotify").hide();\r\n        }\r\n    });    \r\n</script>\r\n'}function g(a,b){var d,e,f="";return f+='\r\n                <tr>\r\n                    <td><a href="javascript:void(0);" class="orderlink link-to-patient-orders" data-index="'+j((d=null==b||b===!1?b:b.index,typeof d===i?d.apply(a):d))+'" data-patientUri="',(e=c.patientUri)?d=e.call(a,{hash:{},data:b}):(e=a&&a.patientUri,d=typeof e===i?e.call(a,{hash:{},data:b}):e),f+=j(d)+'">',(e=c.patientName)?d=e.call(a,{hash:{},data:b}):(e=a&&a.patientName,d=typeof e===i?e.call(a,{hash:{},data:b}):e),f+=j(d)+"</a></td>\r\n                    <td>",(e=c.patientId)?d=e.call(a,{hash:{},data:b}):(e=a&&a.patientId,d=typeof e===i?e.call(a,{hash:{},data:b}):e),f+=j(d)+"</td>\r\n                    <td>",(e=c.patientDob)?d=e.call(a,{hash:{},data:b}):(e=a&&a.patientDob,d=typeof e===i?e.call(a,{hash:{},data:b}):e),f+=j(d)+'</td>\r\n                    <td><a href="javascript:void(0);" class="orderlink link-to-order" data-index="'+j((d=null==b||b===!1?b:b.index,typeof d===i?d.apply(a):d))+'" data-patientUri="',(e=c.patientUri)?d=e.call(a,{hash:{},data:b}):(e=a&&a.patientUri,d=typeof e===i?e.call(a,{hash:{},data:b}):e),f+=j(d)+'" data-orderUri="',(e=c.orderUri)?d=e.call(a,{hash:{},data:b}):(e=a&&a.orderUri,d=typeof e===i?e.call(a,{hash:{},data:b}):e),f+=j(d)+'">',(e=c.orderPriority)?d=e.call(a,{hash:{},data:b}):(e=a&&a.orderPriority,d=typeof e===i?e.call(a,{hash:{},data:b}):e),f+=j(d)+"</a></td>\r\n                </tr>\r\n                "}this.compilerInfo=[4,">= 1.0.0"],c=this.merge(c,a.helpers),e=e||{};var h,i="function",j=this.escapeExpression,k=this;return h=c["if"].call(b,b&&b.isreport,{hash:{},inverse:k.noop,fn:k.program(1,f,e),data:e}),h||0===h?h:""}),this.JST["app/templates/Search/search.hbs"]=Handlebars.template(function(a,b,c,d,e){function f(a,b){var d,e="";return e+='\n        <select class="field-dropdown w-select" id="practice" multiple="multiple">\n            ',d=c.each.call(a,a&&a.practices,{hash:{},inverse:p.noop,fn:p.program(2,g,b),data:b}),(d||0===d)&&(e+=d),e+="\n        </select>\n        "}function g(a,b){var c,d="";return d+='\n                <option value="'+o((c=a&&a.uri,typeof c===n?c.apply(a):c))+'">'+o((c=a&&a.practiceName,typeof c===n?c.apply(a):c))+"</option>\n            "}function h(a,b){return'\n        <p id="noPractice">No Practice Available</p>\n        '}function i(a,b){var d,e="";return e+='\n                <select class="form-control" id="practice_OLD" multiple="multiple">\n                    ',d=c.each.call(a,a&&a.practices,{hash:{},inverse:p.noop,fn:p.program(7,j,b),data:b}),(d||0===d)&&(e+=d),e+="\n                </select>\n                "}function j(a,b){var c,d="";return d+='\n                        <option value="'+o((c=a&&a.uri,typeof c===n?c.apply(a):c))+'">'+o((c=a&&a.practiceName,typeof c===n?c.apply(a):c))+"</option>\n                    "}function k(a,b){return'\n                <span class="form-control" id="noPractice_OLD">No Practice Available</span>\n                '}this.compilerInfo=[4,">= 1.0.0"],c=this.merge(c,a.helpers),e=e||{};var l,m="",n="function",o=this.escapeExpression,p=this;return m+='<div style="padding:5px 10px;" class="row w-row result-filter-row">\n    <div style="width:100%;min-height:30px;height:auto;">\n        <a style="float:left;" id="back-btn" href="javascript:void(0)" class="orange-border-btn">< Back</a>\n        <a style="float:right;" id="pref-btn" href="javascript:void(0)" class="orange-border-btn">Preferences</a> \n    </div>\n    <div id="pref-modal" class="form-inline" style="color:#3a3a3a;display:none;margin-top:15px;">\n        <div style="float:right;">\n            <strong>Auto Image: </strong>\n            <select id="auto-select" class="form-control">\n                <option value="">OFF</option>\n                <option value="VM">ON</option>\n            </select>\n            <strong>Report Notification: </strong>\n            <select id="notify-select" class="form-control">\n                <option value="NO">NO</option>\n                <option value="YES">YES</option>\n            </select>\n            <a id="pref-save-btn" href="javascript:void(0);" class="btn btn-warning">Save</a>\n            <a id="pref-cancel-btn" href="javascript:void(0);" class="btn btn-warning">Cancel</a>\n        </div>\n    </div>\n</div>\n\n<div class="row w-row result-filter-row">\n    <!--\n<div class="w-col w-col-7">\n    <input id="fuzzy" class="search w-input full-width" maxlength="120" name="Site-search-4" placeholder="Patient ID or Name or D.O.B.(dd/mm/yyyy)" type="text">\n</div>  -->\n<div class="w-col w-col-3 return-key">\n    <span id="infoPopover" style="font-size:30px;margin-top:4px;color:#f7921e;" class="glyphicon glyphicon-info-sign" aria-hidden="true"></span>\n    <div id="infoPopoverModal" class="popover" style="left:40px;display:none;">\n        <div class="arrow"></div>\n        <div class="popover-content">\n            <p>3rd party patient search requires Patient ID or Name & DOB</p>\n        </div>\n    </div>\n    <input id="patientName" style="width: 82%;position: absolute;top: 0;left: 45px;" class="auto-select search w-input" maxlength="80" name="Site-search-4" placeholder="Patient Name or Accession #" type="text">\n</div>\n<div class="w-col w-col-2 return-key">\n    <input id="dob" class="auto-select search w-input full-width" maxlength="50" name="Site-search-4" placeholder="D.O.B. dd/mm/yyyy" type="text">\n</div>\n<div class="w-col w-col-2 return-key">\n    <input id="patientId" class="auto-select search w-input full-width" maxlength="50" name="Site-search-4" placeholder="Patient ID" type="text">\n</div>\n<div class="w-col w-col-2">\n    <button class="link-info button-primary w-button full-width" onclick="return false;" id="searchBtn">Search\n    </button>\n</div>\n<div class="w-col w-col-3">\n    <div class="btn-group btn-block fillsplit" id="history">\n    <div class="leadcontainer">\n        <button class="link-info button-primary w-button full-width" onclick="return false;" id="patientBtn">Recent Patients</button>\n    </div>\n    <button type="button" class="btn btn-primary dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">\n        <span class="caret"></span>\n        <span class="sr-only">Toggle Dropdown</span>\n    </button>\n    </div>\n</div>\n</div>\n\n<div class="row w-row result-filter-row">\n<div class="w-col w-col-3">\n    <a id="searchOne" class="link-info button-primary w-button full-width">My Patients - 30 Days</a>\n</div>\n<div class="w-col w-col-3">\n    <a id="searchTwo" class="link-info button-primary w-button full-width">My Patients - 90 Days</a>\n</div>\n<div class="w-col w-col-3">\n    <a id="searchThree" class="link-info button-primary w-button full-width">My Patients - All Time</a>\n</div>\n<div class="w-col w-col-3">\n<div class="dropwdown-filter w-dropdown" data-delay="0" data-click="1">\n    <div class="global-dropdown">\n    <div><a href="#" onClick="$(\'#advancedSearchDropdown\').toggleClass(\'w--open\');" class="link-info button-primary w-button full-width sort-dropdown"><i class="fa fa-sort-amount-desc" aria-hidden="true"></i>My Patients – Search</a></div>\n    </div>\n    <div id="advancedSearchDropdown" class="list-filter w-dropdown-list" data-ix="dropdown-fade">\n    <p class="small-margin-top">\n        SHOW DAYS\n    </p>\n    <select class="field-dropdown w-select" data-name="searchDate" id="searchDate" name="searchDate" onchange="dateRangeChange()">\n        <option value="0,0">Today</option>\n        <option value="-1,-1">Yesterday</option>\n        <option value="-1,0">Past 2 days</option>\n        <option value="-7,0">Past week</option>\n        <option value="-14,0">Past 2 weeks</option>\n        <option value="-30,0" selected>Past 30 days</option>\n        <option value="custom">Custom</option>\n        <option value="all">All time</option>\n    </select>\n    <div id="customDateRange" style="display: none;">\n        <div >\n            <label for="startDate">Start Date</label>\n            <div>\n                <input style="color:#333333" class="w-input full-width" placeholder="dd/mm/yyyy" type="text" id="startDate">\n            </div>\n        </div>\n        <div >\n            <label for="endDate">End Date</label>\n            <div>\n                <input style="color:#333333" class="w-input full-width" placeholder="dd/mm/yyyy" type="text" id="endDate">\n            </div>\n        </div>\n    </div>\n     <script>\n        function dateRangeChange() {\n            var range = $("#searchDate")[0].value;\n            var style = "";\n            if (range != "custom") {\n                style = "none";\n            }\n            $("#customDateRange")[0].style.display = style;\n        }\n    </script>\n<!--    <p class="small-margin-top">\n        MODALITY\n    </p>\n    <select class="field-dropdown w-select" data-name="modality" id="modality" name="modality">\n        <option value="">Any</option>\n        <option value="CR">CR</option>\n        <option value="US">US</option>\n        <option value="CT">CT</option>\n        <option value="MRI">MRI</option>\n        <option value="MG">MG</option>\n        <option value="NM">NM</option>\n        <option value="PET">PET</option>\n    </select> -->\n    <p class="small-margin-top">\n        TYPE\n    </p>\n    <select class="field-dropdown w-select" data-name="searchType" id="searchType" name="searcType">\n        <option value="all">All Locations</option>\n        <option value="linked">At selected practices</option>\n        <option value="referrer">Referred by me at selected practices</option>\n    </select>\n    <p class="small-margin-top">\n        PRACTICE\n    </p>\n    <div class="practice-multiselect">\n        ',l=c["if"].call(b,b&&b.practices,{hash:{},inverse:p.program(4,h,e),fn:p.program(1,f,e),data:e}),(l||0===l)&&(m+=l),m+='\n    </div>\n    <a class="search-on-advance link-info" id="advancedSearchLaunch" title="Launch Search">Search</a>\n    </div>\n</div>\n</div>\n</div>\n\n<script>\n$(document).ready(function(){\n    new Pikaday({ field: document.getElementById(\'startDate\') ,format: \'DD/MM/YYYY\'});\n    new Pikaday({ field: document.getElementById(\'endDate\') ,format: \'DD/MM/YYYY\'});\n});\n</script>\n\n<!-- old -->\n<!--\n<form class="form-horizontal">\n    <div class="col-md-6 col-xs-6">\n        \n        <div class="form-group" id="filterBy" style="display: none;">\n            <label for="searchType" class="col-md-2 col-xs-12 control-label">Show:</label>\n            <div class="col-md-4 col-xs-12">\n                <select class="form-control" id="searchType" data-toggle="tooltip" data-placement="top" title="Only return cases directly referred by yourself, or also those referred by doctors you are associated with">\n                    <option value="referrer">Referred by me</option>\n                    <option value="linked">Linked</option>\n                </select>\n            </div>\n            <label for="practice" class="col-md-2 col-xs-12 control-label">At Practice:</label>\n            <div class="col-md-4 col-xs-12">\n                ',l=c["if"].call(b,b&&b.practices,{hash:{},inverse:p.program(9,k,e),fn:p.program(6,i,e),data:e}),(l||0===l)&&(m+=l),m+='\n            </div>\n        </div>\n    </div>\n    <div class="col-md-3 col-xs-6">\n        <div class="form-group">\n            <label for="filter" class="col-md-6 control-label">Filter:</label>\n            <div class="col-md-6">\n                <input type="checkbox" class="form-control" id="filter"\n                       onclick="clickFilter(this)">\n            </div>\n            <script>\n                function clickFilter(checkbox) {\n                    if (checkbox.checked) $("#filterBy")[0].style.display = "";\n                    else $("#filterBy")[0].style.display = "none";\n                }\n            </script>\n        </div>\n\n    </div>\n    -->\n    \n    <!--\n</form>\n-->'}),this.JST["app/templates/SearchResult/searchresult.hbs"]=Handlebars.template(function(a,b,c,d,e){function f(a,b){return' class="warning"'}function g(a,b){return'<span class="glyphicon glyphicon-lock"></span>'}function h(a,b){return'<div id="popupPatient" class="popover">\n    <div class="arrow"></div>\n    <div class="popover-content"><button class="btn btn-danger" id="bgpatient">Break Glass - EMERGENCY USE</button></div>\n    </div>'}function i(a,b){return'\n            <div id="popupOrder" class="popover">\n                <div class="arrow"></div>\n                <div class="popover-content"><button class="btn btn-danger" id="bgorder">Break Glass - EMERGENCY USE</button></div>\n            </div>\n        '}function j(a,b){var d,e="";return d=c.unless.call(a,null==b||b===!1?b:b.first,{hash:{},inverse:p.noop,fn:p.program(10,k,b),data:b}),(d||0===d)&&(e+=d),e+=r((d=a&&a.modality,typeof d===q?d.apply(a):d))}function k(a,b){return"\n        , "}this.compilerInfo=[4,">= 1.0.0"],c=this.merge(c,a.helpers),e=e||{};var l,m,n,o="",p=this,q="function",r=this.escapeExpression,s=c.helperMissing;return o+="<tr",m=c.compare||b&&b.compare,n={hash:{operator:"!="},inverse:p.noop,fn:p.program(1,f,e),data:e},l=m?m.call(b,(l=b&&b.result,null==l||l===!1?l:l.status),"complete",n):s.call(b,"compare",(l=b&&b.result,null==l||l===!1?l:l.status),"complete",n),(l||0===l)&&(o+=l),o+='>\n    <td><a id="patient" href="javascript:">',l=c.unless.call(b,(l=b&&b.result,null==l||l===!1?l:l.accessible),{hash:{},inverse:p.noop,fn:p.program(3,g,e),data:e}),(l||0===l)&&(o+=l),o+=r((l=b&&b.result,l=null==l||l===!1?l:l.patient,l=null==l||l===!1?l:l.name,typeof l===q?l.apply(b):l))+"</a>",l=c.unless.call(b,(l=b&&b.result,null==l||l===!1?l:l.accessible),{hash:{},inverse:p.noop,fn:p.program(5,h,e),data:e}),(l||0===l)&&(o+=l),o+="</td>\n    <td>"+r((l=b&&b.result,l=null==l||l===!1?l:l.patient,l=null==l||l===!1?l:l.id,typeof l===q?l.apply(b):l))+'</td>\n    <td data-sort-value="'+r((l=b&&b.result,l=null==l||l===!1?l:l.patient,l=null==l||l===!1?l:l.dob,typeof l===q?l.apply(b):l))+'">'+r((l=b&&b.result,l=null==l||l===!1?l:l.patient,l=null==l||l===!1?l:l.dobAus,typeof l===q?l.apply(b):l))+'</td>\n    <td data-sort-value="'+r((l=b&&b.result,l=null==l||l===!1?l:l.date,typeof l===q?l.apply(b):l))+'"><a id="order" href="javascript:">\n        ',l=c.unless.call(b,(l=b&&b.result,null==l||l===!1?l:l.accessible),{hash:{},inverse:p.noop,fn:p.program(3,g,e),data:e}),(l||0===l)&&(o+=l),o+="\n        "+r((l=b&&b.result,l=null==l||l===!1?l:l.dateAus,typeof l===q?l.apply(b):l))+"</a>\n        ",l=c.unless.call(b,(l=b&&b.result,null==l||l===!1?l:l.accessible),{hash:{},inverse:p.noop,fn:p.program(7,i,e),data:e}),(l||0===l)&&(o+=l),o+="</td>\n    <!--<td>"+r((l=b&&b.result,l=null==l||l===!1?l:l.description,typeof l===q?l.apply(b):l))+"</td>-->\n    <td>",l=c.each.call(b,(l=b&&b.result,null==l||l===!1?l:l.procedures),{hash:{},inverse:p.noop,fn:p.program(9,j,e),data:e}),(l||0===l)&&(o+=l),o+="</td>\n    <td>"+r((l=b&&b.result,l=null==l||l===!1?l:l.referrer,l=null==l||l===!1?l:l.name,typeof l===q?l.apply(b):l))+"</td>\n    <td>"+r((l=b&&b.result,l=null==l||l===!1?l:l.status,typeof l===q?l.apply(b):l))+"</td>\n</tr>\n\n\n"}),this.JST["app/templates/SearchResults/searchresults.hbs"]=Handlebars.template(function(a,b,c,d,e){return this.compilerInfo=[4,">= 1.0.0"],c=this.merge(c,a.helpers),e=e||{},'<h2>Search Results</h2>\n<table class="table" id="srTable" data-cascade="true" data-sorting="true" data-filtering="true">\n    <thead>\n    <tr>\n        <th data-priority="1" data-type="html" data-sort-use="text">Name</th>\n        <th data-breakpoints="sm">Patient ID</th>\n        <th data-priority="1">DOB</th>\n        <th data-priority="1" data-type="html" data-sort-use="text" data-sorted="true" data-direction="DESC">Study Date</th>\n        <!--<th data-class-name="search-filter">Description</th>-->\n        <th data-breakpoints="sm" data-class-name="select-filter" data-name="modality">Modality</th>\n        <th data-breakpoints="sm">Referrer</th>\n        <th data-breakpoints="sm">Status</th>\n    </tr>\n    </thead>\n    <tbody>\n    </tbody>\n    <!--<tfoot>\n    <tr>\n        <td></td>\n        <td></td>\n        <td></td>\n        <td></td>\n        &lt;!&ndash;<td></td>&ndash;&gt;\n        <td></td>\n        <td></td>\n        <td></td>\n    </tr>\n    </tfoot>-->\n</table>\n<a class="back-btn orange-border-btn" href="javascript:void(0)">< Back</a>\n\n'}),this.JST["app/templates/Viewer/iframeviewer.hbs"]=Handlebars.template(function(a,b,c,d,e){this.compilerInfo=[4,">= 1.0.0"],c=this.merge(c,a.helpers),e=e||{};var f,g,h="",i="function",j=this.escapeExpression;return h+="<iframe scrolling=\"no\" style='border: 0px none; min-height:1700px; width: 100%;' src='",(g=c.viewer)?f=g.call(b,{hash:{},data:e}):(g=b&&b.viewer,f=typeof g===i?g.call(b,{hash:{},data:e}):g),h+=j(f)+"'></iframe>"}),this.JST["app/templates/Viewer/inteleviewer.hbs"]=Handlebars.template(function(a,b,c,d,e){this.compilerInfo=[4,">= 1.0.0"],c=this.merge(c,a.helpers),e=e||{};var f,g,h="",i="function",j=this.escapeExpression;return h+='<iframe id="inteleviewer" style="width: 100%; height: 300px;" src="',(g=c.inteleviewer)?f=g.call(b,{hash:{},data:e}):(g=b&&b.inteleviewer,f=typeof g===i?g.call(b,{hash:{},data:e}):g),h+=j(f)+'"></iframe>\n'}),this.JST["app/templates/Viewer/viewer.hbs"]=Handlebars.template(function(a,b,c,d,e){this.compilerInfo=[4,">= 1.0.0"],c=this.merge(c,a.helpers),e=e||{};var f,g,h="",i="function",j=this.escapeExpression;
return h+='<div id="viewercontrol" style="width: 100%; background-color: #f7921e;" class="clearfix">\n    <button id="popout" title="Open VueMotion in a new window" class="btn btn-warning btn-sm pull-right hidden-xs">\n        <span id="popouticon" class="glyphicon glyphicon-new-window"></span>\n    </button>\n    <button id="fullscreen" title="Full Screen" class="btn btn-warning btn-sm pull-right hidden-xs">\n        <span id="fullscreenicon" class="glyphicon glyphicon-resize-full"></span>\n    </button>\n    <button id="viewer-back" title="Close" class="btn btn-warning btn-sm pull-left hidden-xs">\n        <span id="backicon" class="glyphicon glyphicon-remove"></span>\n    </button>\n    <span style="color: #fff; line-height: 29.6px; margin-left: 10px;"></span> <!--used be powered by VM -->\n</div>\n<iframe id="imageframe" style="width: 100%;" src="',(g=c.viewer)?f=g.call(b,{hash:{},data:e}):(g=b&&b.viewer,f=typeof g===i?g.call(b,{hash:{},data:e}):g),h+=j(f)+'"></iframe>\n'}),IMED={Models:{},Collections:{},Views:{},Routers:{}},Handlebars.registerHelper("equal",function(a,b,c){if(arguments.length<3)throw new Error("Handlebars Helper equal needs 2 parameters");return a!=b?c.inverse(this):c.fn(this)}),Handlebars.registerHelper("compare",function(a,b,c){if(arguments.length<3)throw new Error("Handlerbars Helper 'compare' needs 2 parameters");var d=c.hash.operator||"==",e={"==":function(a,b){return a==b},"===":function(a,b){return a===b},"!=":function(a,b){return a!=b},"<":function(a,b){return b>a},">":function(a,b){return a>b},"<=":function(a,b){return b>=a},">=":function(a,b){return a>=b},"typeof":function(a,b){return typeof a==b},"&&":function(a,b){return a&&b},"||":function(a,b){return a||b}};if(!e[d])throw new Error("Handlerbars Helper 'compare' doesn't know the operator "+d);var f=e[d](a,b);return f?c.fn(this):c.inverse(this)}),function(){_.extend(Backbone.Router.prototype,Backbone.Events,{before:function(){},after:function(){},route:function(a,b,c){Backbone.history||(Backbone.history=new Backbone.History),_.isRegExp(a)||(a=this._routeToRegExp(a)),c||(c=this[b]),Backbone.history.route(a,_.bind(function(b){var d=this,e=this._extractParameters(a,b);e.push(b);var f=!0;_(this.before).isFunction()&&(f=this.before.apply(this,e)),f&&(c&&c.apply(d,e),_(this.after).isFunction()&&this.after.apply(this,e))},this))},beforeNav:function(){},afterNav:function(){},navigate:function(a,b){return _(this.beforeNav).isFunction()&&this.beforeNav.apply(this,[a]),Backbone.history.navigate(a,b),_(this.afterNav).isFunction()&&this.afterNav.apply(this,[a]),this}})}.call(this),function(){_.each(["Model","Collection"],function(a){var b=Backbone[a],c=b.prototype.fetch;b.prototype.fetch=function(){return this.trigger("fetch",this),c.apply(this,arguments)}})}.call(this),FooTable.MyFiltering=FooTable.Filtering.extend({construct:function(a){this._super(a),this.modalities=[{name:"Plain X-RAY",value:"CR"},{name:"Ultrasound",value:"US"},{name:"CT",value:"CT"},{name:"MRI",value:"MRI"},{name:"Mammography",value:"MG"},{name:"Nuclear Medicine",value:"NM"},{name:"PET",value:"PET"}],this.def="Modality Filter",this.$modality=null},$create:function(){this._super();var a=this;a.$form.empty();var b=$("<div/>",{"class":"form-group"}).append($("<label/>",{"class":"sr-only",text:"Modality"})).prependTo(a.$form);a.$modality=$("<select/>",{"class":"form-control"}).on("change",{self:a},a._onStatusDropdownChanged).append($("<option/>",{text:a.def})).appendTo(b),$.each(a.modalities,function(b,c){a.$modality.append($("<option/>").text(c.name).val(c.value))})},_onStatusDropdownChanged:function(a){var b=a.data.self,c=$(this).val();c!==b.def?b.addFilter("modality",c,["modality"]):b.removeFilter("modality"),b.filter()},draw:function(){this._super();var a=this.find("modality");a instanceof FooTable.Filter?this.$modality.val(a.query.val()):this.$modality.val(this.def)}}),FooTable.components.register("filtering",FooTable.MyFiltering),IMED.Models.HistoryItem=Backbone.Model.extend({}),IMED.Models.InteleViewer=Backbone.Model.extend({url:function(){return imedvisageBase()+"/viewIv"},initialize:function(){this.urls=[],this.attributes.ivUri="",this.fetch({data:{orderUri:this.attributes.orderUri,accessionNumber:this.attributes.accessionNumber}})},parse:function(a){this.urls=a,this.test(a)},fetch:function(a){this.attributes.accessible===!1&&(a.data.breakGlass=!0),this.constructor.__super__.fetch.call(this,a)},test:function(a){var b=this,c=[];a.forEach(function(a){var d=document.createElement("iframe");d.style.display="none",d.onload=function(){d.contentWindow.length>0&&(b.attributes.ivUri=d.src,b.trigger("change:ivUri")),document.body.removeChild(d)},d.src=a,document.body.appendChild(d),c.push(d)})}}),IMED.Models.IvEvViewer=Backbone.Model.extend({url:function(){return imedvisageBase()+"/viewIvEv"},initialize:function(){this.urls=[],this.attributes.ivUri="",this.fetch({data:{mode:"rest",orderUri:this.attributes.orderUri,accessionNumber:this.attributes.accessionNumber}})},parse:function(a){this.urls=a,this.viewer=this.urls&&this.urls.length>0?this.urls[0]:"",this.attributes.ivUri=this.viewer,this.test(this.urls)},fetch:function(a){this.attributes.accessible===!1&&(a.data.breakGlass=!0),this.constructor.__super__.fetch.call(this,a)},getIvUri:function(){return console.log("getIvUri()",this.urls,this.viewer,this.attributes),this.urls[0]},test:function(a){}}),IMED.Models.Order=Backbone.Model.extend({url:function(){return imedvisageBase()+"/order"},initialize:function(){this.attributes.orderUri&&this.fetch()},fetch:function(a){a=_.extend(a||{},{data:{orderUri:this.attributes.orderUri},error:this.fetch_error}),this.attributes.accessible===!1&&(a.data.breakGlass=!0),this.constructor.__super__.fetch.call(this,a)},imagesAvailable:function(){var a=["images available","complete"],b=[];if(this.attributes.status){var c=this;b=a.filter(function(a){return a===c.attributes.status})}return b.length>0},reportAvailable:function(){return""!==this.attributes.reportUri},dicomAvailable:function(){return this.attributes.dicom&&this.attributes.dicom.length>0},referralAvailable:function(){var a=!1;return this.attributes.attachments&&this.attributes.attachments.forEach(function(b){"Request"===b.type&&(a=!0)}),a},referral:function(){var a="";return this.attributes.attachments.forEach(function(b){"Request"===b.type&&(a=b.pages[0].uri)}),this.attributes.accessible===!1&&(a+="&breakGlass=true"),a+="&orderUri="+this.attributes.orderUri},accessionNumbers:function(){var a=[];if(""!==this.attributes.accessionNumber){var b=this.attributes.accessionNumber;this.attributes.procedures&&this.attributes.procedures.length>1?this.attributes.procedures.forEach(function(c,d){a.push({accessionNumber:b,description:c.description,procedure:d})}):a.push({accessionNumber:b,description:this.attributes.description})}else this.attributes.procedures.forEach(function(b){""!==b.accessionNumber&&a.push({accessionNumber:b.accessionNumber,description:b.description})});return a},dicomStudies:function(){var a=[],b=this.attributes.dicom;return b&&b.length>0&&b.forEach(function(b){a.push({accessionNumber:b.accessionNumber,description:b.studyDescription,suid:b.studyInstanceUID})}),a},toJSON:function(){var a=this.constructor.__super__.toJSON.call(this);return a.imagesAvailable=this.imagesAvailable(),a.reportAvailable=this.reportAvailable(),a.referralAvailable=this.referralAvailable(),a.accessionNumbers=this.accessionNumbers(),a.dicomAvailable=this.dicomAvailable(),a},fetch_error:function(a,b,c){403===b.status?(console.log("Break glass required"),a.trigger("breakGlass")):a.trigger("loadError")}}),IMED.Models.Patient=Backbone.Model.extend({url:function(){return imedvisageBase()+"/patient"},initialize:function(){this.attributes.patientUri&&this.fetch(),this.listenTo(this,"sync",this.onSync)},fetch:function(a){a=_.extend(a||{},{data:{patientUri:this.attributes.patientUri}}),this.constructor.__super__.fetch.call(this,a)},onSync:function(){HistoryPatients.fetch()}}),IMED.Models.Report=Backbone.Model.extend({url:function(){return imedvisageBase()+"/report"},initialize:function(){this.attributes.reportUri&&this.fetch()},parse:function(a){this.report=a},fetch:function(a){a=_.extend(a||{},{dataType:"text",data:{reportUri:this.attributes.reportUri,orderUri:this.attributes.orderUri},error:this.fetch_error}),this.attributes.accessible===!1&&(a.data.breakGlass=!0),this.constructor.__super__.fetch.call(this,a)},fetch_error:function(a,b,c){a.trigger("error")},report_pdf:function(){var a={reportUri:this.attributes.reportUri,orderUri:this.attributes.orderUri};return this.attributes.accessible===!1&&(a.breakGlass=!0),this.url()+"Pdf?"+$.param(a)}}),IMED.Models.ReportNotify=Backbone.Model.extend({url:function(){return imedvisageBase()+"/reportNotify/recent"}}),IMED.Models.ReportPdf=Backbone.Model.extend({url:function(){return imedvisageBase()+"/reportPdf"},fetch:function(a){a=_.extend(a||{},{dataType:"text",data:{reportUri:this.attributes.reportUri},error:this.fetch_error}),this.attributes.accessible===!1&&(a.data.breakGlass=!0),this.constructor.__super__.fetch.call(this,a)}}),IMED.Models.SearchResult=Backbone.Model.extend({}),IMED.Models.User=Backbone.Model.extend({url:function(){return imedvisageBase()+"/user"},parse:function(a){var b=a.practices.reduce(function(a,b){var c=b.providerNumber;return delete b.providerNumber,a[c]?(""===a[c].practiceName&&(a[c].practiceName=b.practiceName),a[c].uri+=","+b.uri):a[c]=b,a},{});for(var c in b)""===b[c].practiceName&&(""===b[c].address.line1?b[c].practiceName="[No Name]":b[c].practiceName=b[c].address.line1);return a.practices=b,a}}),IMED.Models.UserPreferences=Backbone.Model.extend({url:function(){return imedvisageBase()+"/preferences"}}),IMED.Models.Viewer=Backbone.Model.extend({url:function(){return imedvisageBase()+"/view"},initialize:function(){var a={orderUri:this.attributes.orderUri,viewer:this.attributes.viewerId};this.fetch({data:a})},parse:function(a){this.viewer=a},fetch:function(a){a=_.extend(a||{},{dataType:"text"}),a.data.viewer||(a.data.viewer=1),this.attributes.accessible===!1&&(a.data.breakGlass=!0),this.constructor.__super__.fetch.call(this,a)}}),IMED.Collections.History=Backbone.Collection.extend({model:IMED.Models.HistoryItem,url:imedvisageBase()+"/history",fetch:function(a){return a=a||{},a.cache=!1,Backbone.Collection.prototype.fetch.call(this,a)}}),IMED.Collections.PatientOrders=Backbone.Collection.extend({model:IMED.Models.SearchResult,url:imedvisageBase()+"/patientOrders",initialize:function(a,b){var c=b.showAll;"undefined"==typeof c&&(c=!1),this.hiddenCount=0,this.patientUri=b.patientUri,this.fetch(c)},parse:function(a){return this.hiddenCount=a.hidden,a.results},fetch:function(a){Backbone.Collection.prototype.fetch.call(this,{data:{patientUri:this.patientUri,showAll:a},error:this.fetch_error})},fetch_error:function(a,b,c){a.trigger("error")}}),IMED.Collections.SearchResults=Backbone.Collection.extend({model:IMED.Models.SearchResult,url:imedvisageBase()+"/searchOrders",fetch:function(a){a=_.extend(a||{},{error:this.fetch_error}),this.constructor.__super__.fetch.call(this,a)},fetch_error:function(a,b,c){a.trigger("error")}}),IMED.Views.Attachment=Backbone.View.extend({initialize:function(a){this.urlBase=imedvisageBase()+"/attachment",this.attachmentUri=a.attachmentUri},events:{"click #close-attachment":"clearInner"},render:function(){this.$el.html("<div style='width: 100%; background-color: #f7921e;' class='clearfix'><button id='close-attachment' title='Close' class='btn btn-warning btn-sm pull-left hidden-xs'><span class='glyphicon glyphicon-remove'></span></button></div><img class='zoom-pan-image-viewer' style='width:45%;height:auto;' src='"+this.urlBase+"?attachmentUri="+this.attachmentUri+"'>"),$("#images").css("top",""),this.viewer=ImageViewer(this.$el.find(".zoom-pan-image-viewer")),this.$el.append(this.viewer);var a=this;return window.setTimeout(function(){a.viewer.refresh()},2500),this},clearInner:function(){this.$el&&this.$el.empty(),this.viewer&&(this.viewer.destroy(),this.viewer=null)}}),IMED.Views.LeftPane=Backbone.View.extend({initialize:function(){this.views=[],this.view=null},events:{"click #back":"back"},render:function(){if(this.view){var a=flatten(this.view.render().$el);this.$el.html(a)}return this},pushView:function(a){this.view&&this.views.push(this.view),this.view=a,this.render(),MainView.maximiseLeftPane()},popView:function(){this.view.remove(),this.view.unbind(),this.view=this.views.pop(),this.render(),MainView.maximiseLeftPane()},back:function(){history.back()}}),IMED.Views.Main=Backbone.View.extend({template:JST["app/templates/Main/main.hbs"],Views:{},events:{"click #showSearchbtn":"toggleSearch"},render:function(){var a=$(this.template());this.$el.html(flatten(a));var b=this.$("#search");this.Views.ReportNotify=new IMED.Views.ReportNotify,b.append(this.Views.ReportNotify.render().el),this.Views.SearchView=new IMED.Views.Search(User,HistoryPatients),b.append(this.Views.SearchView.render().el),this.Views.LeftPane=new IMED.Views.LeftPane;var c=new IMED.Views.SearchResults({collection:SearchResults});return this.Views.LeftPane.pushView(c),b=this.$("#results"),b.append(this.Views.LeftPane.render().el),this},autoScroll:function(){window.scrollTo(0,300)},launchPatient:function(a,b){this.autoScroll();var c={patientUri:a};b===!1&&(c.showAll=!0);var d=new IMED.Models.Patient,e=new IMED.Collections.PatientOrders(null,c),f=new IMED.Views.Patient(d,e);this.Views.LeftPane.pushView(f),d.attributes.patientUri=a,d.fetch()},launchSearch:function(a){var b=new IMED.Collections.SearchResults,c=new IMED.Views.SearchResults({collection:b});this.Views.LeftPane.pushView(c),b.fetch({data:a})},launchOrder:function(a,b,c){this.autoScroll();var d=new IMED.Models.Order,e=new IMED.Models.Patient({patientUri:b}),f=new IMED.Views.Order(d,e);this.Views.LeftPane.pushView(f),d.attributes.orderUri=a,"boolean"==typeof c&&(d.attributes.accessible=c),d.fetch(),this.showRightPane()},launchImages:function(a,b,c,d){if(5==b){var e={orderUri:a,accessionNumber:c.accessionNumber};"boolean"==typeof d&&(e.accessible=d);var f=new IMED.Models.InteleViewer(e),g=new IMED.Views.InteleViewer({model:f});this.clearImages(),this.Views.RightPane=g;var h=this.$("#images");h.append(this.Views.RightPane.render().el)}else if(9==b){var e={orderUri:a,accessionNumber:c.accessionNumber};"boolean"==typeof d&&(e.accessible=d);var i=new IMED.Models.IvEvViewer(e),g=new IMED.Views.Viewer({model:i});this.clearImages(),this.Views.RightPane=g;var h=this.$("#images");h.append(this.Views.RightPane.render().el)}else{var e={orderUri:a,viewerId:b};"boolean"==typeof d&&(e.accessible=d);var i=new IMED.Models.Viewer(e),g=new IMED.Views.Viewer({model:i});this.clearImages(),this.Views.RightPane=g;var h=this.$("#images");h.append(this.Views.RightPane.render().el)}},clearImages:function(){this.Views.RightPane&&(this.Views.RightPane.clearInner&&this.Views.RightPane.clearInner(),this.Views.RightPane.remove(),this.Views.RightPane.unbind(),delete this.Views.RightPane)},launchReferral:function(a){console.log("Launching Referral viewer");var b=new IMED.Views.Attachment({attachmentUri:a});this.clearImages(),this.Views.RightPane=b;var c=this.$("#images");c.append(this.Views.RightPane.render().el)},maximiseLeftPane:function(){this.$("#images")[0].style.display="none",this.$("#results").removeClass("col-md-6").addClass("col-md-12")},showRightPane:function(){this.$("#results").removeClass("col-md-12").addClass("col-md-6"),this.$("#images")[0].style.display="block"},toggleSearch:function(){this.Views.SearchView.active?(this.Views.SearchView.active=!1,$("#search").collapse("hide")):(this.Views.SearchView.active=!0,$("#search").collapse("show"))}}),IMED.Views.Order=Backbone.View.extend({template:JST["app/templates/Order/order.hbs"],events:{"click a.back-btn":"goBack","click #referral":"launchReferral","click #bgorder":"breakGlass","click #report-pdf":"downloadPdf","click #viewbyiv":"launchViewIv","click #vuemotionButton":isViewIvEv()?"launchViewIvEv":"launchViewVuemotion"},initialize:function(a,b){this.orderModel=a,this.reportModel=new IMED.Models.Report,this.patientModel=b,this.listenTo(this.orderModel,"fetch",this.fetch_trig),this.patientHeader=new IMED.Views.PatientHeader({model:this.patientModel}),this.orderHeader=new IMED.Views.OrderHeader({model:this.orderModel}),this.orderReport=new IMED.Views.OrderReport({model:this.reportModel}),this.listenToOnce(this.orderModel,"sync",this.retrieveReport),this.listenTo(this.reportModel,"sync",this.render),this.listenTo(this.orderModel,"loadError",this.fetch_error),this.listenTo(this.orderModel,"breakGlass",this.breakGlassRequired),this.listenTo(this.reportModel,"error",this.fetch_error)},goBack:function(){history.back()},render:function(){var a=$(this.template({order:this.orderHeader.model.toJSON()}));if(this.$el.html(flatten(a)),!isViewIvEv()){var b=this.$("#patient");b.append(this.patientHeader.render().el),b=this.$("#order"),b.append(this.orderHeader.render().el),b=this.$("#report"),b.append(this.orderReport.render().el)}var c=this.orderModel.dicomStudies(),d=new IMED.Views.Viewers({collection:c,parent:this});this.$el.find(".viewbyvm").append(d.render().el),this.$el.find(".viewbyvm .dropdown-toggle").dropdown();var e=UserPreferences.attributes;if(console.log("UserPreferences",e),this.orderModel.dicomStudies().length>0&&e.autoimg&&"VM"==e.autoimg&&(isViewIvEv()||this.launchViewVuemotion()),isViewIvEv()&&this.orderModel.dicomStudies().length>0){var f={orderUri:this.orderHeader.model.attributes.orderUri,accessionNumber:this.orderModel.dicomStudies()[0].accessionNumber};"boolean"==typeof this.orderModel.attributes.accessible&&(f.accessible=this.orderModel.attributes.accessible),this.ivModel=new IMED.Models.IvEvViewer(f),this.ifviewer=new IMED.Views.IvEvIframeViewer({model:this.ivModel}),$("#results").removeClass("col-md-6").addClass("col-md-12"),this.$("#report").append(this.ifviewer.render().el)}return this},launchViewIv:function(){this.launchImages(5,this.orderModel.dicomStudies()[0])},launchViewVuemotion:function(){this.launchImages(3,this.orderModel.dicomStudies()[0])},launchViewIvEv:function(){this.launchImages(9,this.orderModel.dicomStudies()[0])},launchImages:function(a,b){if($(".nav.section .warnEmailBanner").length>0)alert("Images are available only after an unique personal email address is provided by My Account page.");else{"number"!=typeof a&&(a=3);var c="boolean"==typeof this.orderModel.attributes.accessible?this.orderModel.attributes.accessible:!0;MainView.launchImages(this.orderHeader.model.attributes.orderUri,a,b,c)}},retrieveReport:function(){this.orderModel.reportAvailable()?(this.reportModel.attributes.reportUri=this.orderHeader.model.attributes.reportUri,this.reportModel.attributes.orderUri=this.orderHeader.model.attributes.orderUri,"boolean"==typeof this.orderModel.attributes.accessible&&(this.reportModel.attributes.accessible=this.orderModel.attributes.accessible),this.reportModel.fetch()):this.render()},fetch_trig:function(){console.log("Fetching"),this.$el.html("<div id='spinner'><img alt='Searching...' src='data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBzdGFuZGFsb25lPSJubyI/Pgo8IURPQ1RZUEUgc3ZnIFBVQkxJQyAiLS8vVzNDLy9EVEQgU1ZHIDEuMS8vRU4iICJodHRwOi8vd3d3LnczLm9yZy9HcmFwaGljcy9TVkcvMS4xL0RURC9zdmcxMS5kdGQiPgo8c3ZnIHdpZHRoPSI0MHB4IiBoZWlnaHQ9IjQwcHgiIHZpZXdCb3g9IjAgMCA0MCA0MCIgdmVyc2lvbj0iMS4xIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIiB4bWw6c3BhY2U9InByZXNlcnZlIiBzdHlsZT0iZmlsbC1ydWxlOmV2ZW5vZGQ7Y2xpcC1ydWxlOmV2ZW5vZGQ7c3Ryb2tlLWxpbmVqb2luOnJvdW5kO3N0cm9rZS1taXRlcmxpbWl0OjEuNDE0MjE7IiB4PSIwcHgiIHk9IjBweCI+CiAgICA8ZGVmcz4KICAgICAgICA8c3R5bGUgdHlwZT0idGV4dC9jc3MiPjwhW0NEQVRBWwogICAgICAgICAgICBALXdlYmtpdC1rZXlmcmFtZXMgc3BpbiB7CiAgICAgICAgICAgICAgZnJvbSB7CiAgICAgICAgICAgICAgICAtd2Via2l0LXRyYW5zZm9ybTogcm90YXRlKDBkZWcpCiAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIHRvIHsKICAgICAgICAgICAgICAgIC13ZWJraXQtdHJhbnNmb3JtOiByb3RhdGUoLTM1OWRlZykKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgQGtleWZyYW1lcyBzcGluIHsKICAgICAgICAgICAgICBmcm9tIHsKICAgICAgICAgICAgICAgIHRyYW5zZm9ybTogcm90YXRlKDBkZWcpCiAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIHRvIHsKICAgICAgICAgICAgICAgIHRyYW5zZm9ybTogcm90YXRlKC0zNTlkZWcpCiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIHN2ZyB7CiAgICAgICAgICAgICAgICAtd2Via2l0LXRyYW5zZm9ybS1vcmlnaW46IDUwJSA1MCU7CiAgICAgICAgICAgICAgICAtd2Via2l0LWFuaW1hdGlvbjogc3BpbiAxLjVzIGxpbmVhciBpbmZpbml0ZTsKICAgICAgICAgICAgICAgIC13ZWJraXQtYmFja2ZhY2UtdmlzaWJpbGl0eTogaGlkZGVuOwogICAgICAgICAgICAgICAgYW5pbWF0aW9uOiBzcGluIDEuNXMgbGluZWFyIGluZmluaXRlOwogICAgICAgICAgICB9CiAgICAgICAgXV0+PC9zdHlsZT4KICAgIDwvZGVmcz4KICAgIDxnIGlkPSJvdXRlciI+CiAgICAgICAgPGc+CiAgICAgICAgICAgIDxwYXRoIGQ9Ik0yMCwwQzIyLjIwNTgsMCAyMy45OTM5LDEuNzg4MTMgMjMuOTkzOSwzLjk5MzlDMjMuOTkzOSw2LjE5OTY4IDIyLjIwNTgsNy45ODc4MSAyMCw3Ljk4NzgxQzE3Ljc5NDIsNy45ODc4MSAxNi4wMDYxLDYuMTk5NjggMTYuMDA2MSwzLjk5MzlDMTYuMDA2MSwxLjc4ODEzIDE3Ljc5NDIsMCAyMCwwWiIgc3R5bGU9ImZpbGw6YmxhY2s7Ii8+CiAgICAgICAgPC9nPgogICAgICAgIDxnPgogICAgICAgICAgICA8cGF0aCBkPSJNNS44NTc4Niw1Ljg1Nzg2QzcuNDE3NTgsNC4yOTgxNSA5Ljk0NjM4LDQuMjk4MTUgMTEuNTA2MSw1Ljg1Nzg2QzEzLjA2NTgsNy40MTc1OCAxMy4wNjU4LDkuOTQ2MzggMTEuNTA2MSwxMS41MDYxQzkuOTQ2MzgsMTMuMDY1OCA3LjQxNzU4LDEzLjA2NTggNS44NTc4NiwxMS41MDYxQzQuMjk4MTUsOS45NDYzOCA0LjI5ODE1LDcuNDE3NTggNS44NTc4Niw1Ljg1Nzg2WiIgc3R5bGU9ImZpbGw6cmdiKDIxMCwyMTAsMjEwKTsiLz4KICAgICAgICA8L2c+CiAgICAgICAgPGc+CiAgICAgICAgICAgIDxwYXRoIGQ9Ik0yMCwzMi4wMTIyQzIyLjIwNTgsMzIuMDEyMiAyMy45OTM5LDMzLjgwMDMgMjMuOTkzOSwzNi4wMDYxQzIzLjk5MzksMzguMjExOSAyMi4yMDU4LDQwIDIwLDQwQzE3Ljc5NDIsNDAgMTYuMDA2MSwzOC4yMTE5IDE2LjAwNjEsMzYuMDA2MUMxNi4wMDYxLDMzLjgwMDMgMTcuNzk0MiwzMi4wMTIyIDIwLDMyLjAxMjJaIiBzdHlsZT0iZmlsbDpyZ2IoMTMwLDEzMCwxMzApOyIvPgogICAgICAgIDwvZz4KICAgICAgICA8Zz4KICAgICAgICAgICAgPHBhdGggZD0iTTI4LjQ5MzksMjguNDkzOUMzMC4wNTM2LDI2LjkzNDIgMzIuNTgyNCwyNi45MzQyIDM0LjE0MjEsMjguNDkzOUMzNS43MDE5LDMwLjA1MzYgMzUuNzAxOSwzMi41ODI0IDM0LjE0MjEsMzQuMTQyMUMzMi41ODI0LDM1LjcwMTkgMzAuMDUzNiwzNS43MDE5IDI4LjQ5MzksMzQuMTQyMUMyNi45MzQyLDMyLjU4MjQgMjYuOTM0MiwzMC4wNTM2IDI4LjQ5MzksMjguNDkzOVoiIHN0eWxlPSJmaWxsOnJnYigxMDEsMTAxLDEwMSk7Ii8+CiAgICAgICAgPC9nPgogICAgICAgIDxnPgogICAgICAgICAgICA8cGF0aCBkPSJNMy45OTM5LDE2LjAwNjFDNi4xOTk2OCwxNi4wMDYxIDcuOTg3ODEsMTcuNzk0MiA3Ljk4NzgxLDIwQzcuOTg3ODEsMjIuMjA1OCA2LjE5OTY4LDIzLjk5MzkgMy45OTM5LDIzLjk5MzlDMS43ODgxMywyMy45OTM5IDAsMjIuMjA1OCAwLDIwQzAsMTcuNzk0MiAxLjc4ODEzLDE2LjAwNjEgMy45OTM5LDE2LjAwNjFaIiBzdHlsZT0iZmlsbDpyZ2IoMTg3LDE4NywxODcpOyIvPgogICAgICAgIDwvZz4KICAgICAgICA8Zz4KICAgICAgICAgICAgPHBhdGggZD0iTTUuODU3ODYsMjguNDkzOUM3LjQxNzU4LDI2LjkzNDIgOS45NDYzOCwyNi45MzQyIDExLjUwNjEsMjguNDkzOUMxMy4wNjU4LDMwLjA1MzYgMTMuMDY1OCwzMi41ODI0IDExLjUwNjEsMzQuMTQyMUM5Ljk0NjM4LDM1LjcwMTkgNy40MTc1OCwzNS43MDE5IDUuODU3ODYsMzQuMTQyMUM0LjI5ODE1LDMyLjU4MjQgNC4yOTgxNSwzMC4wNTM2IDUuODU3ODYsMjguNDkzOVoiIHN0eWxlPSJmaWxsOnJnYigxNjQsMTY0LDE2NCk7Ii8+CiAgICAgICAgPC9nPgogICAgICAgIDxnPgogICAgICAgICAgICA8cGF0aCBkPSJNMzYuMDA2MSwxNi4wMDYxQzM4LjIxMTksMTYuMDA2MSA0MCwxNy43OTQyIDQwLDIwQzQwLDIyLjIwNTggMzguMjExOSwyMy45OTM5IDM2LjAwNjEsMjMuOTkzOUMzMy44MDAzLDIzLjk5MzkgMzIuMDEyMiwyMi4yMDU4IDMyLjAxMjIsMjBDMzIuMDEyMiwxNy43OTQyIDMzLjgwMDMsMTYuMDA2MSAzNi4wMDYxLDE2LjAwNjFaIiBzdHlsZT0iZmlsbDpyZ2IoNzQsNzQsNzQpOyIvPgogICAgICAgIDwvZz4KICAgICAgICA8Zz4KICAgICAgICAgICAgPHBhdGggZD0iTTI4LjQ5MzksNS44NTc4NkMzMC4wNTM2LDQuMjk4MTUgMzIuNTgyNCw0LjI5ODE1IDM0LjE0MjEsNS44NTc4NkMzNS43MDE5LDcuNDE3NTggMzUuNzAxOSw5Ljk0NjM4IDM0LjE0MjEsMTEuNTA2MUMzMi41ODI0LDEzLjA2NTggMzAuMDUzNiwxMy4wNjU4IDI4LjQ5MzksMTEuNTA2MUMyNi45MzQyLDkuOTQ2MzggMjYuOTM0Miw3LjQxNzU4IDI4LjQ5MzksNS44NTc4NloiIHN0eWxlPSJmaWxsOnJnYig1MCw1MCw1MCk7Ii8+CiAgICAgICAgPC9nPgogICAgPC9nPgo8L3N2Zz4K'/></div>"),$("#spinner").height($(window).height()-this.$el.offset().top-30)},fetch_error:function(){console.log("Fetch error"),this.$el.html("<div style='display: table;width:100%;height:"+($(window).height()-this.$el.offset().top-30)+"px'><div style='display:table-cell;vertical-align:middle;text-align:center;color:#333;'>An error occurred. Report Not Avaiable.</div></div>")},launchReferral:function(){MainView.launchReferral(this.orderModel.referral())},breakGlassRequired:function(){console.log("Displaying break glass dialog"),this.$el.html("<div style='display: table;width:100%;height:"+($(window).height()-this.$el.offset().top-30)+"px'><div style='display:table-cell;vertical-align:middle;text-align:center;color:#333;'><button class='btn btn-danger' id='bgorder'>Break Glass - EMERGENCY USE</button></div></div>")},breakGlass:function(){this.orderModel.attributes.accessible=!1,this.orderModel.fetch()},downloadPdf:function(){var a=this.reportModel.report_pdf();window.open(a)}}),IMED.Views.ViewerItem=Backbone.View.extend({template:JST["app/templates/Order/vieweritem.hbs"],tagName:"li",events:{"click a":"viewer"},initialize:function(a){this.target=a.target,this.listenTo(this.model,"sync",this.render)},render:function(){var a=this.model.description;a&&a.length>20&&(a=a.substring(0,20)+"...");var b=$(this.template({name:a}));return this.$el.html(b),this},viewer:function(){console.log("Clicked: "+this.model.description),this.target.launchImages(3,this.model)}}),IMED.Views.Viewers=Backbone.View.extend({template:JST["app/templates/Order/viewers.hbs"],tagName:"ul",attributes:{"class":"dropdown-menu dropdown-menu-right"},initialize:function(a){this.views=[],this.parent=a.parent,this.listenTo(this.collection,"sync",this.render)},render:function(){this.views.forEach(function(a){a.remove(),a.unbind()}),this.views=[];var a=$(this.template());this.$el.html(a);var b=this;if(this.collection&&this.collection.length>0)for(var c=0;c<this.collection.length;c++)console.log(this.collection[c]),b.views.push(new IMED.Views.ViewerItem({model:this.collection[c],target:b}));var d=document.createDocumentFragment();return this.views.forEach(function(a){d.appendChild(a.render().el)}),this.$el.append(d),this},launchImages:function(a,b){this.parent.launchImages(a,b)}}),IMED.Views.OrderHeader=Backbone.View.extend({template:JST["app/templates/OrderHeader/orderheader.hbs"],initialize:function(){this.listenTo(this.model,"sync",this.render)},render:function(){var a=$(this.template({order:this.model.toJSON()}));return this.$el.html(flatten(a)),this}}),IMED.Views.OrderReport=Backbone.View.extend({template:JST["app/templates/OrderReport/orderreport.hbs"],attributes:{style:"overflow: auto;"},initialize:function(){this.listenTo(this.model,"sync",this.render)},render:function(){if(""!==this.model.attributes.reportUri&&this.model.attributes.reportUri){var a=$(this.template({report:this.model.report}));this.$el.html(flatten(a))}else this.$el.html("<p>No report available.</p>");return this},resize:function(a){a?a.data.self.$el.height($(window).height()-$("#report-panel")[0].getBoundingClientRect().top-$("#reportbottom").height()-100):$("#report").length>0&&this.$el.height($(window).height()-$("#report-panel")[0].getBoundingClientRect().top-$("#reportbottom").height()-100)}}),IMED.Views.Patient=Backbone.View.extend({template:JST["app/templates/Patient/patient.hbs"],initialize:function(a,b){this.patientModel=a,this.patientHeader=new IMED.Views.PatientHeader({model:this.patientModel}),this.patientOrders=new IMED.Views.PatientOrders({collection:b}),this.listenTo(this.patientModel,"fetch",this.fetch_trig),this.listenTo(b,"sync",this.render),this.listenTo(this.patientModel,"error",this.fetch_error),this.listenTo(b,"error",this.fetch_error)},events:{"click #showAll":"showAll"},render:function(){var a=$(this.template());this.$el.html(flatten(a));var b=this.$("#patient");return b.append(this.patientHeader.render().el),b=this.$("#orders"),b.append(this.patientOrders.render().el),this},showAll:function(){this.patientOrders.collection.fetch(!0)},fetch_trig:function(){console.log("Fetching"),this.$el.html("<div id='spinner'><img alt='Searching...' src='data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBzdGFuZGFsb25lPSJubyI/Pgo8IURPQ1RZUEUgc3ZnIFBVQkxJQyAiLS8vVzNDLy9EVEQgU1ZHIDEuMS8vRU4iICJodHRwOi8vd3d3LnczLm9yZy9HcmFwaGljcy9TVkcvMS4xL0RURC9zdmcxMS5kdGQiPgo8c3ZnIHdpZHRoPSI0MHB4IiBoZWlnaHQ9IjQwcHgiIHZpZXdCb3g9IjAgMCA0MCA0MCIgdmVyc2lvbj0iMS4xIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIiB4bWw6c3BhY2U9InByZXNlcnZlIiBzdHlsZT0iZmlsbC1ydWxlOmV2ZW5vZGQ7Y2xpcC1ydWxlOmV2ZW5vZGQ7c3Ryb2tlLWxpbmVqb2luOnJvdW5kO3N0cm9rZS1taXRlcmxpbWl0OjEuNDE0MjE7IiB4PSIwcHgiIHk9IjBweCI+CiAgICA8ZGVmcz4KICAgICAgICA8c3R5bGUgdHlwZT0idGV4dC9jc3MiPjwhW0NEQVRBWwogICAgICAgICAgICBALXdlYmtpdC1rZXlmcmFtZXMgc3BpbiB7CiAgICAgICAgICAgICAgZnJvbSB7CiAgICAgICAgICAgICAgICAtd2Via2l0LXRyYW5zZm9ybTogcm90YXRlKDBkZWcpCiAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIHRvIHsKICAgICAgICAgICAgICAgIC13ZWJraXQtdHJhbnNmb3JtOiByb3RhdGUoLTM1OWRlZykKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgQGtleWZyYW1lcyBzcGluIHsKICAgICAgICAgICAgICBmcm9tIHsKICAgICAgICAgICAgICAgIHRyYW5zZm9ybTogcm90YXRlKDBkZWcpCiAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIHRvIHsKICAgICAgICAgICAgICAgIHRyYW5zZm9ybTogcm90YXRlKC0zNTlkZWcpCiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIHN2ZyB7CiAgICAgICAgICAgICAgICAtd2Via2l0LXRyYW5zZm9ybS1vcmlnaW46IDUwJSA1MCU7CiAgICAgICAgICAgICAgICAtd2Via2l0LWFuaW1hdGlvbjogc3BpbiAxLjVzIGxpbmVhciBpbmZpbml0ZTsKICAgICAgICAgICAgICAgIC13ZWJraXQtYmFja2ZhY2UtdmlzaWJpbGl0eTogaGlkZGVuOwogICAgICAgICAgICAgICAgYW5pbWF0aW9uOiBzcGluIDEuNXMgbGluZWFyIGluZmluaXRlOwogICAgICAgICAgICB9CiAgICAgICAgXV0+PC9zdHlsZT4KICAgIDwvZGVmcz4KICAgIDxnIGlkPSJvdXRlciI+CiAgICAgICAgPGc+CiAgICAgICAgICAgIDxwYXRoIGQ9Ik0yMCwwQzIyLjIwNTgsMCAyMy45OTM5LDEuNzg4MTMgMjMuOTkzOSwzLjk5MzlDMjMuOTkzOSw2LjE5OTY4IDIyLjIwNTgsNy45ODc4MSAyMCw3Ljk4NzgxQzE3Ljc5NDIsNy45ODc4MSAxNi4wMDYxLDYuMTk5NjggMTYuMDA2MSwzLjk5MzlDMTYuMDA2MSwxLjc4ODEzIDE3Ljc5NDIsMCAyMCwwWiIgc3R5bGU9ImZpbGw6YmxhY2s7Ii8+CiAgICAgICAgPC9nPgogICAgICAgIDxnPgogICAgICAgICAgICA8cGF0aCBkPSJNNS44NTc4Niw1Ljg1Nzg2QzcuNDE3NTgsNC4yOTgxNSA5Ljk0NjM4LDQuMjk4MTUgMTEuNTA2MSw1Ljg1Nzg2QzEzLjA2NTgsNy40MTc1OCAxMy4wNjU4LDkuOTQ2MzggMTEuNTA2MSwxMS41MDYxQzkuOTQ2MzgsMTMuMDY1OCA3LjQxNzU4LDEzLjA2NTggNS44NTc4NiwxMS41MDYxQzQuMjk4MTUsOS45NDYzOCA0LjI5ODE1LDcuNDE3NTggNS44NTc4Niw1Ljg1Nzg2WiIgc3R5bGU9ImZpbGw6cmdiKDIxMCwyMTAsMjEwKTsiLz4KICAgICAgICA8L2c+CiAgICAgICAgPGc+CiAgICAgICAgICAgIDxwYXRoIGQ9Ik0yMCwzMi4wMTIyQzIyLjIwNTgsMzIuMDEyMiAyMy45OTM5LDMzLjgwMDMgMjMuOTkzOSwzNi4wMDYxQzIzLjk5MzksMzguMjExOSAyMi4yMDU4LDQwIDIwLDQwQzE3Ljc5NDIsNDAgMTYuMDA2MSwzOC4yMTE5IDE2LjAwNjEsMzYuMDA2MUMxNi4wMDYxLDMzLjgwMDMgMTcuNzk0MiwzMi4wMTIyIDIwLDMyLjAxMjJaIiBzdHlsZT0iZmlsbDpyZ2IoMTMwLDEzMCwxMzApOyIvPgogICAgICAgIDwvZz4KICAgICAgICA8Zz4KICAgICAgICAgICAgPHBhdGggZD0iTTI4LjQ5MzksMjguNDkzOUMzMC4wNTM2LDI2LjkzNDIgMzIuNTgyNCwyNi45MzQyIDM0LjE0MjEsMjguNDkzOUMzNS43MDE5LDMwLjA1MzYgMzUuNzAxOSwzMi41ODI0IDM0LjE0MjEsMzQuMTQyMUMzMi41ODI0LDM1LjcwMTkgMzAuMDUzNiwzNS43MDE5IDI4LjQ5MzksMzQuMTQyMUMyNi45MzQyLDMyLjU4MjQgMjYuOTM0MiwzMC4wNTM2IDI4LjQ5MzksMjguNDkzOVoiIHN0eWxlPSJmaWxsOnJnYigxMDEsMTAxLDEwMSk7Ii8+CiAgICAgICAgPC9nPgogICAgICAgIDxnPgogICAgICAgICAgICA8cGF0aCBkPSJNMy45OTM5LDE2LjAwNjFDNi4xOTk2OCwxNi4wMDYxIDcuOTg3ODEsMTcuNzk0MiA3Ljk4NzgxLDIwQzcuOTg3ODEsMjIuMjA1OCA2LjE5OTY4LDIzLjk5MzkgMy45OTM5LDIzLjk5MzlDMS43ODgxMywyMy45OTM5IDAsMjIuMjA1OCAwLDIwQzAsMTcuNzk0MiAxLjc4ODEzLDE2LjAwNjEgMy45OTM5LDE2LjAwNjFaIiBzdHlsZT0iZmlsbDpyZ2IoMTg3LDE4NywxODcpOyIvPgogICAgICAgIDwvZz4KICAgICAgICA8Zz4KICAgICAgICAgICAgPHBhdGggZD0iTTUuODU3ODYsMjguNDkzOUM3LjQxNzU4LDI2LjkzNDIgOS45NDYzOCwyNi45MzQyIDExLjUwNjEsMjguNDkzOUMxMy4wNjU4LDMwLjA1MzYgMTMuMDY1OCwzMi41ODI0IDExLjUwNjEsMzQuMTQyMUM5Ljk0NjM4LDM1LjcwMTkgNy40MTc1OCwzNS43MDE5IDUuODU3ODYsMzQuMTQyMUM0LjI5ODE1LDMyLjU4MjQgNC4yOTgxNSwzMC4wNTM2IDUuODU3ODYsMjguNDkzOVoiIHN0eWxlPSJmaWxsOnJnYigxNjQsMTY0LDE2NCk7Ii8+CiAgICAgICAgPC9nPgogICAgICAgIDxnPgogICAgICAgICAgICA8cGF0aCBkPSJNMzYuMDA2MSwxNi4wMDYxQzM4LjIxMTksMTYuMDA2MSA0MCwxNy43OTQyIDQwLDIwQzQwLDIyLjIwNTggMzguMjExOSwyMy45OTM5IDM2LjAwNjEsMjMuOTkzOUMzMy44MDAzLDIzLjk5MzkgMzIuMDEyMiwyMi4yMDU4IDMyLjAxMjIsMjBDMzIuMDEyMiwxNy43OTQyIDMzLjgwMDMsMTYuMDA2MSAzNi4wMDYxLDE2LjAwNjFaIiBzdHlsZT0iZmlsbDpyZ2IoNzQsNzQsNzQpOyIvPgogICAgICAgIDwvZz4KICAgICAgICA8Zz4KICAgICAgICAgICAgPHBhdGggZD0iTTI4LjQ5MzksNS44NTc4NkMzMC4wNTM2LDQuMjk4MTUgMzIuNTgyNCw0LjI5ODE1IDM0LjE0MjEsNS44NTc4NkMzNS43MDE5LDcuNDE3NTggMzUuNzAxOSw5Ljk0NjM4IDM0LjE0MjEsMTEuNTA2MUMzMi41ODI0LDEzLjA2NTggMzAuMDUzNiwxMy4wNjU4IDI4LjQ5MzksMTEuNTA2MUMyNi45MzQyLDkuOTQ2MzggMjYuOTM0Miw3LjQxNzU4IDI4LjQ5MzksNS44NTc4NloiIHN0eWxlPSJmaWxsOnJnYig1MCw1MCw1MCk7Ii8+CiAgICAgICAgPC9nPgogICAgPC9nPgo8L3N2Zz4K'/></div>"),
$("#spinner").height($(window).height()-this.$el.offset().top-30)},fetch_error:function(){console.log("Fetch error"),this.$el.html("<div style='display: table;width:100%;height:"+($(window).height()-this.$el.offset().top-30)+"px'><div style='display:table-cell;vertical-align:middle;text-align:center;color:#333;'>Unable to communicate Visage server. If you don't have any Visage account, please ignore this error.</div></div>")}}),IMED.Views.PatientHeader=Backbone.View.extend({template:JST["app/templates/PatientHeader/patientheader.hbs"],initialize:function(){this.listenTo(this.model,"sync",this.render)},render:function(){this.model.attributes.dobAus=this.ausDate(this.model.attributes.dob);var a=$(this.template({patient:this.model.toJSON()}));return this.$el.html(flatten(a)),this},ausDate:function(a){return moment(a).format("DD/MM/YYYY")}}),IMED.Views.PatientOrder=Backbone.View.extend({template:JST["app/templates/PatientOrders/patientorder.hbs"],events:{"click #order":"clickOrder","click #bgorder":"clickOrderBg"},render:function(){this.model.attributes.dateAus=this.ausDate(this.model.attributes.date);var a=$(this.template({order:this.model.toJSON()}));if(this.$el[0].tagName===a[0].tagName?this.$el.html=a.html():this.setElement(a),!this.model.attributes.accessible){var b=this;this.$el.find("#order").popover({html:!0,placement:"right",trigger:"focus",content:function(){return b.$el.find("#popupOrder").html()}})}return this},ausDate:function(a){return moment(a).format("DD/MM/YYYY")},clickOrder:function(){console.log("Clicked order: "+this.model.attributes.uri),this.model.attributes.accessible?this.launchOrder():(console.log("Need to break glass"),this.$el.find("#popupOrder").popover("show"))},clickOrderBg:function(){console.log("Break glass on order: "+this.model.attributes.uri),this.launchOrder()},launchOrder:function(){console.log("Launching order: "+this.model.attributes.uri);var a=this.model.attributes.patient.uri.split("/"),b=a[a.length-1],c=this.model.attributes.uri.split("/"),d=c[c.length-1];Router.navigate("patient/"+b+"/order/"+d),MainView.launchOrder(this.model.attributes.uri,this.model.attributes.patient.uri,this.model.attributes.accessible)}}),IMED.Views.PatientOrders=Backbone.View.extend({template:JST["app/templates/PatientOrders/patientorders.hbs"],initialize:function(){this.views=[],this.listenTo(this.collection,"sync",this.render)},render:function(){this.views.forEach(function(a){a.remove(),a.unbind()}),this.views=[];var a=$(this.template({hidden:this.collection.hiddenCount})),b=this;this.collection.each(function(a){b.views.push(new IMED.Views.PatientOrder({model:a}))});var c=document.createDocumentFragment();this.views.forEach(function(a){c.appendChild(a.render().el)}),a.find("tbody").append(c),this.$el.html(flatten(a));this.$el.find("#srTable").footable({empty:"No results found."});return this}}),IMED.Views.History=Backbone.View.extend({template:JST["app/templates/Search/history.hbs"],tagName:"ul",attributes:{"class":"dropdown-menu dropdown-menu-right"},initialize:function(){this.views=[],this.listenTo(this.collection,"sync",this.render)},render:function(){this.views.forEach(function(a){a.remove(),a.unbind()}),this.views=[];var a=$(this.template());this.$el.html(a);var b=this;this.collection.each(function(a){b.views.push(new IMED.Views.HistoryItem({model:a}))});var c=document.createDocumentFragment();return this.views.forEach(function(a){c.appendChild(a.render().el)}),this.$el.append(c),this}}),IMED.Views.HistoryItem=Backbone.View.extend({template:JST["app/templates/Search/historyitem.hbs"],tagName:"li",events:{"click a":"patient"},initialize:function(){this.listenTo(this.model,"sync",this.render)},render:function(){var a=$(this.template({name:this.model.attributes.name}));return this.$el.html(a),this},patient:function(){console.log("Clicked: "+this.model.attributes.name);var a=this.model.attributes.uri.split("/"),b=a[a.length-1];Router.navigate("patient/"+b),MainView.launchPatient(this.model.attributes.uri)}}),IMED.Views.ReportNotify=Backbone.View.extend({template:JST["app/templates/Search/reportNotify.hbs"],events:{"click a.link-to-patient-orders":"launchPatientOrders","click a.link-to-order":"launchOrder"},initialize:function(){this.orders=[],this.doFetch();var a=this;window.setInterval(_.bind(a.doFetch,a),3e5)},doFetch:function(){this.model=new IMED.Models.ReportNotify;var a=this;this.model.fetch().done(function(){a.render(),a.showToast()})},showToast:function(){var a=this,b=!this.model.isEmpty();b&&($.each(this.model.attributes,function(a,b){if(b.push){var c="Standard"==b.orderPriority?"a new":"an URGENT";$.toast({heading:"I-MED Radiology",text:'<a href="javascript:void(0);" data-patientUri="'+b.patientUri+'" data-orderUri="'+b.orderUri+'" class="toast-link">You have '+c+" report</a>",hideAfter:5e3,stack:3,loader:!1,position:"bottom-center",textAlign:"left",icon:"info"})}}),$("a.toast-link").on("click",function(b){a.launchOrder(b)}))},render:function(){var a=!this.model.isEmpty(),b=$(this.template({orders:this.model.attributes,isreport:a}));return this.$el.html(flatten(b)),this},launchPatientOrders:function(a){Router.navigate($(a.currentTarget).attr("data-patientUri")),MainView.launchPatient($(a.currentTarget).attr("data-patientUri"),!0)},launchOrder:function(a){Router.navigate($(a.currentTarget).attr("data-patientUri")+$(a.currentTarget).attr("data-orderUri")),MainView.launchOrder($(a.currentTarget).attr("data-orderUri"),$(a.currentTarget).attr("data-patientUri"),!0)},ausDate:function(a){return moment(a).format("DD/MM/YYYY")},formatDate:function(a){return moment(a,"DD/MM/YYYY").format("YYYY-MM-DD")}}),IMED.Views.Search=Backbone.View.extend({template:JST["app/templates/Search/search.hbs"],events:{"click #searchBtn":"searchAll","keyup .return-key":"keyUpHandler","mouseenter #infoPopover":"popInfo","mouseleave #infoPopover":"popInfo","click input.auto-select":"selectAllText","click #clearSearch":"clearSearch","click #searchOne":"doSearchOne","click #searchTwo":"doSearchTwo","click #searchThree":"doSearchThree","click #searchRecent":"searchRecent","click #searchAll":"searchAll","click #advancedSearchLaunch":"advancedSearchLaunch","click #back-btn":"goBack","click #pref-btn":"openPrefModal","click #pref-save-btn":"savePref","click #pref-cancel-btn":"cancelPref"},initialize:function(a,b){this.user=a,this.listenTo(this.user,"sync",this.render),this.history=b,this.history.fetch(),this.mobileWidth=600,$(window).on("resize",{self:this},this.resize),this.active=!0},render:function(){var a=this.user.attributes.practices,b=$(this.template({practices:a}));this.$el.html(flatten(b));var c=new IMED.Views.History({collection:this.history});if(this.$el.find("#history").append(c.render().el),this.$el.find(".dropdown-toggle").dropdown(),$("#practice").multiselect("destroy"),a){$("#practice").multiselect({includeSelectAllOption:!0,selectAllText:"All",allSelectedText:"All",selectAllValue:"all",buttonClass:"field-dropdown w-select practice-multiselect-button"});var d=$("button.practice-multiselect-button"),e=$(d.closest("div"));d.on("click",function(a){a.stopPropagation(),e.toggleClass("open")}),e.find(".multiselect-container.dropdown-menu li a").css("padding","0px 5px")}return $(window).width()<=this.mobileWidth&&$("#search").removeClass("in"),this.$('[data-toggle="tooltip"]').tooltip(),this},selectAllText:function(a){a.target.select()},formatDate:function(a){return moment(a,"DD/MM/YYYY").format("YYYY-MM-DD")},clearSearchFields:function(){this.$el.find("#patientName").val(""),this.$el.find("#patientId").val(""),this.$el.find("#dob").val("")},getBaseCriteria:function(){var a={},b=this.$el.find("#patientName").val();""!==b&&(b.trim().match(/^[0-9|\.]+$/)?a.accessionNum=b.trim():a.search=b.replace(","," "));var c=this.$el.find("#patientId").val();""!==c&&(a.patientId=c);var d=this.$el.find("#dob").val();return""!==d&&(a.dob=this.formatDate(d)),console.log(a),a},getAttributes:function(){var a=this.getBaseCriteria();a.searchType=this.$el.find("#searchType").val(),"all"!=a.searchType&&this.$el.find("#practice option:selected").length>0&&(a.practices=this.$el.find("#practice option:selected").map(function(a,b){return b.value}).get().join(","));var b=this.$el.find("#searchDate").val();if("all"!==b){var c=[];if("custom"!==b){var d=b.split(",").map(function(a){return parseInt(a)||0});c=dateRange(d[0],d[1])}else c[0]=this.formatDate(this.$el.find("#startDate").val()),c[1]=this.formatDate(this.$el.find("#endDate").val());a.startDate=c[0],a.endDate=c[1]}return a.orderStatus="images available,complete",a},search:function(){MainView.launchSearch(this.getAttributes()),Router.navigate("search")},advancedSearchLaunch:function(){$("#advancedSearchDropdown").removeClass("w--open"),this.search()},searchRecent:function(){this.searchLastDays("linked",7)},doSearchOne:function(){this.searchLastDays("linked",30)},doSearchTwo:function(){this.searchLastDays("linked",90)},doSearchThree:function(){this.searchLastDays("linked")},searchLastDays:function(a,b){var c=this.getBaseCriteria();if(c.searchType=a,b){var d=[];d=dateRange(-1*b,0),c.startDate=d[0],c.endDate=d[1]}c.orderStatus="images available,complete",MainView.launchSearch(c),Router.navigate("search")},searchAll:function(){var a=this.getBaseCriteria();a.searchType="all",a.orderStatus="images available,complete",MainView.launchSearch(a),Router.navigate("search")},keyUpHandler:function(a){13==a.keyCode&&this.$("#searchBtn").click()},openPrefModal:function(){$("#pref-modal").css("display","block");var a=UserPreferences.attributes;$("#auto-select").val(a.autoimg?a.autoimg:""),$("#notify-select").val("YES"==a.notify?"YES":"NO")},savePref:function(){$("#pref-modal").css("display","none"),UserPreferences.save({help:"hide",autoimg:$("#auto-select").val(),notify:$("#notify-select").val()})},cancelPref:function(){$("#pref-modal").css("display","none")},goBack:function(){window.location.hash.length>0&&history.back()},popInfo:function(){$("#infoPopoverModal").toggle()},resize:function(a){var b;b=a?a.data.self:this,$(window).width()<=b.mobileWidth?b.active?$("#search").addClass("in"):$("#search").removeClass("in"):$(window).width()>b.mobileWidth&&b.active&&$("#search").addClass("in")},clearSearch:function(){this.$el.find(":input:not(:checkbox):not(:button)").val(""),this.$el.find("#searchDate").val("-30,0"),this.$el.find("#searchType").val("all")},remove:function(){$(window).off("resize",{self:this},this.resize),Backbone.View.prototype.remove.apply(this,arguments)}}),IMED.Views.SearchResult=Backbone.View.extend({template:JST["app/templates/SearchResult/searchresult.hbs"],events:{"click #patient":"clickPatient","click #order":"clickOrder","click #bgpatient":"clickPatientBg","click #bgorder":"clickOrderBg"},render:function(){this.model.attributes.patient.dobAus=this.ausDate(this.model.attributes.patient.dob),this.model.attributes.dateAus=this.ausDate(this.model.attributes.date);var a=$(this.template({result:this.model.toJSON()}));if(this.$el[0].tagName===a[0].tagName?this.$el.html=a.html():this.setElement(a),!this.model.attributes.accessible){var b=this;this.$el.find("#patient").popover({html:!0,placement:"right",trigger:"focus",content:function(){return b.$el.find("#popupPatient").html()}}),this.$el.find("#order").popover({html:!0,placement:"right",trigger:"focus",content:function(){return b.$el.find("#popupOrder").html()}})}return this},ausDate:function(a){return moment(a).format("DD/MM/YYYY")},clickPatient:function(){console.log("Clicked patient: "+this.model.attributes.patient.uri),this.model.attributes.accessible?this.launchPatient(!0):(console.log("Need to break glass"),this.$el.find("#popupPatient").popover("show"))},clickOrder:function(){console.log("Clicked order: "+this.model.attributes.uri),this.model.attributes.accessible?this.launchOrder(!0):(console.log("Need to break glass"),this.$el.find("#popupOrder").popover("show"))},clickPatientBg:function(){console.log("Break glass on patient: "+this.model.attributes.patient.uri),this.$el.find("#popupOrder").popover("hide"),this.launchPatient(!1)},clickOrderBg:function(){console.log("Break glass on order: "+this.model.attributes.uri),this.$el.find("#popupOrder").popover("hide"),this.launchOrder(!1)},launchPatient:function(a){console.log("Launching patient: "+this.model.attributes.patient.uri);var b=this.model.attributes.patient.uri.split("/"),c=b[b.length-1];Router.navigate("patient/"+c),MainView.launchPatient(this.model.attributes.patient.uri,a)},launchOrder:function(a){var b=this.model.attributes.patient.uri.split("/"),c=b[b.length-1],d=this.model.attributes.uri.split("/"),e=d[d.length-1];Router.navigate("patient/"+c+"/order/"+e),MainView.launchOrder(this.model.attributes.uri,this.model.attributes.patient.uri,a)}}),IMED.Views.SearchResults=Backbone.View.extend({template:JST["app/templates/SearchResults/searchresults.hbs"],events:{"click a.back-btn":"goBack"},initialize:function(){this.views=[],this.listenTo(this.collection,"sync",this.render),this.listenTo(this.collection,"fetch",this.fetch_trig),this.listenTo(this.collection,"error",this.fetch_error)},render:function(){this.views.forEach(function(a){a.remove(),a.unbind()}),this.views=[];var a=$(this.template()),b=this;this.collection.each(function(a){b.views.push(new IMED.Views.SearchResult({model:a}))});var c=document.createDocumentFragment();this.views.forEach(function(a){c.appendChild(a.render().el)}),a.find("tbody").append(c),this.$el.html(flatten(a));this.$el.find("#srTable").footable({empty:"No results found."});return this},fetch_trig:function(){this.$el.html("<div id='spinner'><img alt='Searching...' src='data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBzdGFuZGFsb25lPSJubyI/Pgo8IURPQ1RZUEUgc3ZnIFBVQkxJQyAiLS8vVzNDLy9EVEQgU1ZHIDEuMS8vRU4iICJodHRwOi8vd3d3LnczLm9yZy9HcmFwaGljcy9TVkcvMS4xL0RURC9zdmcxMS5kdGQiPgo8c3ZnIHdpZHRoPSI0MHB4IiBoZWlnaHQ9IjQwcHgiIHZpZXdCb3g9IjAgMCA0MCA0MCIgdmVyc2lvbj0iMS4xIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIiB4bWw6c3BhY2U9InByZXNlcnZlIiBzdHlsZT0iZmlsbC1ydWxlOmV2ZW5vZGQ7Y2xpcC1ydWxlOmV2ZW5vZGQ7c3Ryb2tlLWxpbmVqb2luOnJvdW5kO3N0cm9rZS1taXRlcmxpbWl0OjEuNDE0MjE7IiB4PSIwcHgiIHk9IjBweCI+CiAgICA8ZGVmcz4KICAgICAgICA8c3R5bGUgdHlwZT0idGV4dC9jc3MiPjwhW0NEQVRBWwogICAgICAgICAgICBALXdlYmtpdC1rZXlmcmFtZXMgc3BpbiB7CiAgICAgICAgICAgICAgZnJvbSB7CiAgICAgICAgICAgICAgICAtd2Via2l0LXRyYW5zZm9ybTogcm90YXRlKDBkZWcpCiAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIHRvIHsKICAgICAgICAgICAgICAgIC13ZWJraXQtdHJhbnNmb3JtOiByb3RhdGUoLTM1OWRlZykKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgQGtleWZyYW1lcyBzcGluIHsKICAgICAgICAgICAgICBmcm9tIHsKICAgICAgICAgICAgICAgIHRyYW5zZm9ybTogcm90YXRlKDBkZWcpCiAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIHRvIHsKICAgICAgICAgICAgICAgIHRyYW5zZm9ybTogcm90YXRlKC0zNTlkZWcpCiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIHN2ZyB7CiAgICAgICAgICAgICAgICAtd2Via2l0LXRyYW5zZm9ybS1vcmlnaW46IDUwJSA1MCU7CiAgICAgICAgICAgICAgICAtd2Via2l0LWFuaW1hdGlvbjogc3BpbiAxLjVzIGxpbmVhciBpbmZpbml0ZTsKICAgICAgICAgICAgICAgIC13ZWJraXQtYmFja2ZhY2UtdmlzaWJpbGl0eTogaGlkZGVuOwogICAgICAgICAgICAgICAgYW5pbWF0aW9uOiBzcGluIDEuNXMgbGluZWFyIGluZmluaXRlOwogICAgICAgICAgICB9CiAgICAgICAgXV0+PC9zdHlsZT4KICAgIDwvZGVmcz4KICAgIDxnIGlkPSJvdXRlciI+CiAgICAgICAgPGc+CiAgICAgICAgICAgIDxwYXRoIGQ9Ik0yMCwwQzIyLjIwNTgsMCAyMy45OTM5LDEuNzg4MTMgMjMuOTkzOSwzLjk5MzlDMjMuOTkzOSw2LjE5OTY4IDIyLjIwNTgsNy45ODc4MSAyMCw3Ljk4NzgxQzE3Ljc5NDIsNy45ODc4MSAxNi4wMDYxLDYuMTk5NjggMTYuMDA2MSwzLjk5MzlDMTYuMDA2MSwxLjc4ODEzIDE3Ljc5NDIsMCAyMCwwWiIgc3R5bGU9ImZpbGw6YmxhY2s7Ii8+CiAgICAgICAgPC9nPgogICAgICAgIDxnPgogICAgICAgICAgICA8cGF0aCBkPSJNNS44NTc4Niw1Ljg1Nzg2QzcuNDE3NTgsNC4yOTgxNSA5Ljk0NjM4LDQuMjk4MTUgMTEuNTA2MSw1Ljg1Nzg2QzEzLjA2NTgsNy40MTc1OCAxMy4wNjU4LDkuOTQ2MzggMTEuNTA2MSwxMS41MDYxQzkuOTQ2MzgsMTMuMDY1OCA3LjQxNzU4LDEzLjA2NTggNS44NTc4NiwxMS41MDYxQzQuMjk4MTUsOS45NDYzOCA0LjI5ODE1LDcuNDE3NTggNS44NTc4Niw1Ljg1Nzg2WiIgc3R5bGU9ImZpbGw6cmdiKDIxMCwyMTAsMjEwKTsiLz4KICAgICAgICA8L2c+CiAgICAgICAgPGc+CiAgICAgICAgICAgIDxwYXRoIGQ9Ik0yMCwzMi4wMTIyQzIyLjIwNTgsMzIuMDEyMiAyMy45OTM5LDMzLjgwMDMgMjMuOTkzOSwzNi4wMDYxQzIzLjk5MzksMzguMjExOSAyMi4yMDU4LDQwIDIwLDQwQzE3Ljc5NDIsNDAgMTYuMDA2MSwzOC4yMTE5IDE2LjAwNjEsMzYuMDA2MUMxNi4wMDYxLDMzLjgwMDMgMTcuNzk0MiwzMi4wMTIyIDIwLDMyLjAxMjJaIiBzdHlsZT0iZmlsbDpyZ2IoMTMwLDEzMCwxMzApOyIvPgogICAgICAgIDwvZz4KICAgICAgICA8Zz4KICAgICAgICAgICAgPHBhdGggZD0iTTI4LjQ5MzksMjguNDkzOUMzMC4wNTM2LDI2LjkzNDIgMzIuNTgyNCwyNi45MzQyIDM0LjE0MjEsMjguNDkzOUMzNS43MDE5LDMwLjA1MzYgMzUuNzAxOSwzMi41ODI0IDM0LjE0MjEsMzQuMTQyMUMzMi41ODI0LDM1LjcwMTkgMzAuMDUzNiwzNS43MDE5IDI4LjQ5MzksMzQuMTQyMUMyNi45MzQyLDMyLjU4MjQgMjYuOTM0MiwzMC4wNTM2IDI4LjQ5MzksMjguNDkzOVoiIHN0eWxlPSJmaWxsOnJnYigxMDEsMTAxLDEwMSk7Ii8+CiAgICAgICAgPC9nPgogICAgICAgIDxnPgogICAgICAgICAgICA8cGF0aCBkPSJNMy45OTM5LDE2LjAwNjFDNi4xOTk2OCwxNi4wMDYxIDcuOTg3ODEsMTcuNzk0MiA3Ljk4NzgxLDIwQzcuOTg3ODEsMjIuMjA1OCA2LjE5OTY4LDIzLjk5MzkgMy45OTM5LDIzLjk5MzlDMS43ODgxMywyMy45OTM5IDAsMjIuMjA1OCAwLDIwQzAsMTcuNzk0MiAxLjc4ODEzLDE2LjAwNjEgMy45OTM5LDE2LjAwNjFaIiBzdHlsZT0iZmlsbDpyZ2IoMTg3LDE4NywxODcpOyIvPgogICAgICAgIDwvZz4KICAgICAgICA8Zz4KICAgICAgICAgICAgPHBhdGggZD0iTTUuODU3ODYsMjguNDkzOUM3LjQxNzU4LDI2LjkzNDIgOS45NDYzOCwyNi45MzQyIDExLjUwNjEsMjguNDkzOUMxMy4wNjU4LDMwLjA1MzYgMTMuMDY1OCwzMi41ODI0IDExLjUwNjEsMzQuMTQyMUM5Ljk0NjM4LDM1LjcwMTkgNy40MTc1OCwzNS43MDE5IDUuODU3ODYsMzQuMTQyMUM0LjI5ODE1LDMyLjU4MjQgNC4yOTgxNSwzMC4wNTM2IDUuODU3ODYsMjguNDkzOVoiIHN0eWxlPSJmaWxsOnJnYigxNjQsMTY0LDE2NCk7Ii8+CiAgICAgICAgPC9nPgogICAgICAgIDxnPgogICAgICAgICAgICA8cGF0aCBkPSJNMzYuMDA2MSwxNi4wMDYxQzM4LjIxMTksMTYuMDA2MSA0MCwxNy43OTQyIDQwLDIwQzQwLDIyLjIwNTggMzguMjExOSwyMy45OTM5IDM2LjAwNjEsMjMuOTkzOUMzMy44MDAzLDIzLjk5MzkgMzIuMDEyMiwyMi4yMDU4IDMyLjAxMjIsMjBDMzIuMDEyMiwxNy43OTQyIDMzLjgwMDMsMTYuMDA2MSAzNi4wMDYxLDE2LjAwNjFaIiBzdHlsZT0iZmlsbDpyZ2IoNzQsNzQsNzQpOyIvPgogICAgICAgIDwvZz4KICAgICAgICA8Zz4KICAgICAgICAgICAgPHBhdGggZD0iTTI4LjQ5MzksNS44NTc4NkMzMC4wNTM2LDQuMjk4MTUgMzIuNTgyNCw0LjI5ODE1IDM0LjE0MjEsNS44NTc4NkMzNS43MDE5LDcuNDE3NTggMzUuNzAxOSw5Ljk0NjM4IDM0LjE0MjEsMTEuNTA2MUMzMi41ODI0LDEzLjA2NTggMzAuMDUzNiwxMy4wNjU4IDI4LjQ5MzksMTEuNTA2MUMyNi45MzQyLDkuOTQ2MzggMjYuOTM0Miw3LjQxNzU4IDI4LjQ5MzksNS44NTc4NloiIHN0eWxlPSJmaWxsOnJnYig1MCw1MCw1MCk7Ii8+CiAgICAgICAgPC9nPgogICAgPC9nPgo8L3N2Zz4K'/></div>"),$("#spinner").height($(window).height()-this.$el.offset().top-30)},fetch_error:function(){console.log("Fetch error"),this.$el.html("<div style='display: table;width:100%;height:"+($(window).height()-this.$el.offset().top-30)+"px'><div style='display:table-cell;vertical-align:middle;text-align:center;color:#333;'>Unable to communicate Visage server. If you don't have any Visage account yet, please ignore this error.</div></div>")},goBack:function(){window.location.hash.length>0&&history.back()}}),IMED.Views.InteleViewer=Backbone.View.extend({template:JST["app/templates/Viewer/inteleviewer.hbs"],initialize:function(){this.listenTo(this.model,"change:ivUri",this.render)},render:function(){var a=$(this.template({inteleviewer:this.model.attributes.ivUri}));return this.$el.html(flatten(a)),this}}),IMED.Views.IvEvIframeViewer=Backbone.View.extend({template:JST["app/templates/Viewer/iframeviewer.hbs"],initialize:function(){this.listenTo(this.model,"sync",this.render)},render:function(){var a=$(this.template({viewer:this.model.viewer}));return this.$el.html(flatten(a)),this}}),IMED.Views.Viewer=Backbone.View.extend({template:JST["app/templates/Viewer/viewer.hbs"],initialize:function(){this.listenTo(this.model,"sync",this.render),$(window).on("resize",{self:this},this.resize),this.offset=0,this.fullscreenEnabled=!1,this.mobile=!1},events:{"click #fullscreen":"fullscreen","click #popout":"openNewWindow","click #viewer-back":"closeViewer"},render:function(){var a=$(this.template({viewer:this.model.viewer}));this.$el.html(flatten(a)),this.resize();var b=this;return $("#imageframe").on("mouseover",function(a){console.log(a),b.offset=window.pageYOffset,$("body")[0].style.top=-b.offset+"px",$("body").addClass("noscroll")}),$("#imageframe").on("mouseleave",function(a){console.log(a),$("body").removeClass("noscroll"),$(window).scrollTop(b.offset)}),this},openNewWindow:function(){window.open(this.model.viewer)},resize:function(a){var b;b=a?a.data.self:this,window.innerWidth<767?(b.mobile=!0,b.maximise()):b.mobile&&(b.mobile=!1,b.minimise()),b.fullscreenEnabled||b.mobile||($("#images")[0].style.top=$("#results").position().top+"px",$("#imageframe").height($("#images").height()-29.2))},fullscreen:function(){this.fullscreenEnabled&&!this.mobile?this.minimise():this.maximise()},maximise:function(){var a=$("#images")[0];a.style.zIndex="12020";var b=this.$("#imageframe")[0],c=this.$("#viewercontrol")[0];c.style.top="0px",c.style.left="0px",c.style.position="fixed",b.style.top="29.2px",b.style.left="0px",b.style.bottom="0px",b.style.right="0px",b.style.height=$(window).height()-29.2+"px",b.style.width="100%",b.style.position="fixed",this.mobile||(this.fullscreenEnabled=!0),this.$("#fullscreenicon").removeClass("glyphicon-resize-full").addClass("glyphicon-resize-small")},minimise:function(){var a=$("#images")[0];a.style.zIndex="1000";var b=$("#imageframe")[0],c=$("#viewercontrol")[0];c.style.top="0px",c.style.left="0px",c.style.position="relative",b.style.top="0px",b.style.left="0px",b.style.bottom="0px",b.style.right="0px",b.style.height="100%",b.style.width="100%",b.style.position="relative",b.style.zIndex="12020",this.fullscreenEnabled=!1,this.$("#fullscreenicon").removeClass("glyphicon-resize-small").addClass("glyphicon-resize-full"),this.resize()},closeViewer:function(){MainView.clearImages(),window.setTimeout(function(){$("#images").css("top","")},400)},remove:function(){$(window).off("resize",this.resize),Backbone.View.prototype.remove.apply(this,arguments)}}),IMED.Routers.Router=Backbone.Router.extend({initialize:function(){this.history=[]},routes:{"":"default",search:"default","patient/:patient":"patient","patient/:patient/order/:order":"order"},"default":function(){},patient:function(a){MainView.launchPatient("/patient/"+a)},order:function(a,b){MainView.launchOrder("/order/"+b,"/patient/"+a)},before:function(a,b,c){MainView.clearImages();var d=!0;return 0!==this.history.length&&(this.history[this.history.length-1]===c||void 0===c)&&(this.back(),d=!1),d},after:function(a,b,c){void 0!==c&&this.storeRoute()},storeRoute:function(){this.history.push(Backbone.history.fragment)},beforeNav:function(a){MainView.clearImages(),Backbone.history.fragment!==a&&this.storeRoute()},back:function(){MainView.Views.LeftPane.popView();this.history.pop()}}),$.ajaxSetup({cache:!1});var $body=$("#body");User=new IMED.Models.User,User.fetch(),UserPreferences=new IMED.Models.UserPreferences,UserPreferences.fetch(),HistoryPatients=new IMED.Collections.History;var SearchResults;if("undefined"!=typeof InitialSearch)SearchResults=new IMED.Collections.SearchResults(InitialSearch);else{var dates=dateRange(-7,0);SearchResults=new IMED.Collections.SearchResults,SearchResults.fetch({data:{searchType:"referrer",startDate:dates[0],endDate:dates[1],orderStatus:"images available,complete"}})}MainView=new IMED.Views.Main,$body.append(MainView.render().el),Router=new IMED.Routers.Router,Backbone.history.start();